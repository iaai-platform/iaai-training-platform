<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Library - In-Person Courses</title>
  <link rel="stylesheet" href="/css/inpersonlibrarystyle.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    /* In-Person Library Professional Styling */
/* Enhanced styling maintaining brand colors (dark green #002147 and gold #ffcc00) */

:root {
  /* Brand Colors - Dark Green & Gold Theme */
  --primary-color: #002147;
  --secondary-color: #ffcc00;
  --accent-color: #1a5b3e;
  --gold-light: #ffd700;
  --gold-dark: #b8860b;
  
  /* Status Colors */
  --success-color: #28a745;
  --warning-color: #ffc107;
  --danger-color: #dc3545;
  --info-color: #17a2b8;
  
  /* Neutral Colors */
  --text-dark: #1a1a1a;
  --text-medium: #4a4a4a;
  --text-light: #6c757d;
  --text-muted: #9ca3af;
  
  /* Background Colors */
  --bg-primary: #ffffff;
  --bg-secondary: #f8fafc;
  --bg-tertiary: #f1f5f9;
  --bg-dark: #002147;
  
  /* Border & Shadow */
  --border-color: #e2e8f0;
  --border-radius-sm: 8px;
  --border-radius-md: 12px;
  --border-radius-lg: 20px;
  --border-radius-xl: 24px;
  
  --shadow-xs: 0 1px 3px rgba(0, 0, 0, 0.05);
  --shadow-sm: 0 4px 8px rgba(0, 0, 0, 0.08);
  --shadow-md: 0 8px 16px rgba(0, 0, 0, 0.12);
  --shadow-lg: 0 16px 32px rgba(0, 0, 0, 0.15);
  --shadow-xl: 0 24px 48px rgba(0, 0, 0, 0.2);
  
  /* Brand Gradients */
  --gradient-primary: linear-gradient(135deg, #002147 0%, #1a5b3e 100%);
  --gradient-secondary: linear-gradient(135deg, #ffcc00 0%, #ffd700 100%);
  --gradient-accent: linear-gradient(135deg, #002147 0%, #1a5b3e 60%, #ffcc00 100%);
  --gradient-gold: linear-gradient(135deg, #ffd700 0%, #ffcc00 50%, #b8860b 100%);
  
  /* Transitions */
  --transition-fast: 0.15s ease-out;
  --transition-smooth: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Enhanced Hero Section */
#hero {
  background: var(--gradient-primary);
  color: white;
  padding: 140px 0 100px;
  text-align: center;
  position: relative;
  overflow: hidden;
}

#hero::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 20% 20%, rgba(255, 204, 0, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(255, 215, 0, 0.08) 0%, transparent 50%),
    linear-gradient(45deg, transparent 30%, rgba(255, 204, 0, 0.03) 50%, transparent 70%);
  z-index: 1;
}

#hero::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 100px;
  background: linear-gradient(180deg, transparent 0%, rgba(248, 250, 252, 0.1) 100%);
  z-index: 2;
}

.hero-content {
  position: relative;
  z-index: 3;
  max-width: 1000px;
  margin: 0 auto;
  padding: 0 30px;
  animation: heroSlideUp 1.2s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes heroSlideUp {
  from {
    opacity: 0;
    transform: translateY(60px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.hero-content h1 {
  font-size: clamp(2.8rem, 6vw, 4.5rem);
  font-weight: 800;
  margin-bottom: 30px;
  text-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
  line-height: 1.1;
  letter-spacing: -0.02em;
}

.hero-content h1 i {
  color: var(--secondary-color);
  margin-right: 20px;
  text-shadow: 0 4px 8px rgba(255, 204, 0, 0.4);
}

.hero-content p {
  font-size: clamp(1.1rem, 2.5vw, 1.5rem);
  opacity: 0.95;
  max-width: 650px;
  margin: 0 auto;
  font-weight: 400;
  line-height: 1.6;
}

/* Enhanced Statistics Section */
.library-stats {
  background: var(--bg-primary);
  padding: 60px 40px;
  margin: -80px auto 80px;
  max-width: 1300px;
  border-radius: var(--border-radius-xl);
  box-shadow: var(--shadow-xl);
  position: relative;
  z-index: 10;
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.library-stats::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--gradient-secondary);
  border-radius: var(--border-radius-xl) var(--border-radius-xl) 0 0;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 40px;
  text-align: center;
}

.stat-item {
  padding: 35px 20px;
  border-radius: var(--border-radius-lg);
  transition: var(--transition-smooth);
  position: relative;
  background: linear-gradient(135deg, rgba(0, 33, 71, 0.02), rgba(255, 204, 0, 0.02));
  border: 2px solid transparent;
  cursor: pointer;
}

.stat-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--gradient-accent);
  border-radius: var(--border-radius-lg);
  opacity: 0;
  transition: var(--transition-smooth);
  z-index: -1;
}

.stat-item:hover {
  transform: translateY(-8px) scale(1.02);
  border-color: var(--secondary-color);
  box-shadow: var(--shadow-lg);
}

.stat-item:hover::before {
  opacity: 0.05;
}

.stat-item:hover .stat-number {
  transform: scale(1.1);
}

.stat-number {
  font-size: clamp(2.5rem, 4vw, 3.5rem);
  font-weight: 900;
  background: var(--gradient-gold);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 12px;
  display: block;
  line-height: 1;
  transition: var(--transition-smooth);
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.stat-label {
  color: var(--text-medium);
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 1.2px;
  font-weight: 700;
  margin-top: 8px;
}

/* Professional Course Cards */
.course-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
  gap: 40px;
  animation: courseGridReveal 1s ease-out;
}

@keyframes courseGridReveal {
  from {
    opacity: 0;
    transform: translateY(40px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.course-card {
  background: var(--bg-primary);
  border-radius: var(--border-radius-xl);
  overflow: hidden;
  box-shadow: var(--shadow-md);
  transition: var(--transition-smooth);
  border: 1px solid var(--border-color);
  position: relative;
  animation: cardFloatIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  animation-delay: calc(var(--card-index, 0) * 0.1s);
  transform: translateY(20px);
  opacity: 0;
}

@keyframes cardFloatIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.course-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--gradient-accent);
  opacity: 0;
  transition: var(--transition-smooth);
  z-index: 0;
  border-radius: var(--border-radius-xl);
}

.course-card:hover {
  transform: translateY(-12px) scale(1.02);
  box-shadow: var(--shadow-xl);
  border-color: var(--secondary-color);
}

.course-card:hover::before {
  opacity: 0.02;
}

/* Status-based Card Styling */
.course-card.completed {
  border-left: 6px solid var(--success-color);
}

.course-card.completed::after {
  content: '';
  position: absolute;
  top: 20px;
  right: 20px;
  width: 40px;
  height: 40px;
  background: var(--success-color);
  border-radius: 50%;
  opacity: 0.1;
}

.course-card.in-progress,
.course-card.attended {
  border-left: 6px solid var(--info-color);
}

.course-card.upcoming {
  border-left: 6px solid var(--accent-color);
}

.course-card.needs-action {
  border-left: 6px solid var(--warning-color);
  animation: pulseAttention 3s ease-in-out infinite;
}

@keyframes pulseAttention {
  0%, 100% { box-shadow: var(--shadow-md); }
  50% { box-shadow: 0 8px 24px rgba(255, 193, 7, 0.2), var(--shadow-md); }
}

/* Enhanced Course Header */
.course-header {
  background: var(--gradient-primary);
  color: white;
  padding: 40px;
  position: relative;
  overflow: hidden;
  min-height: 200px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.course-header::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -20%;
  width: 300px;
  height: 300px;
  background: radial-gradient(circle, rgba(255, 204, 0, 0.15) 0%, transparent 70%);
  border-radius: 50%;
  animation: float 6s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-20px) rotate(180deg); }
}

.course-header::after {
  content: '';
  position: absolute;
  bottom: -30px;
  left: -30px;
  width: 150px;
  height: 150px;
  background: linear-gradient(45deg, rgba(255, 204, 0, 0.1), transparent);
  border-radius: 50%;
  animation: floatReverse 8s ease-in-out infinite;
}

@keyframes floatReverse {
  0%, 100% { transform: translateX(0) scale(1); }
  50% { transform: translateX(15px) scale(1.1); }
}

/* Course Status Badge */
.course-status {
  position: absolute;
  top: 20px;
  right: 20px;
  padding: 10px 18px;
  border-radius: 25px;
  font-weight: 700;
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  display: flex;
  align-items: center;
  gap: 6px;
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow-sm);
  border: 1px solid rgba(255, 255, 255, 0.2);
  z-index: 5;
  transition: var(--transition-smooth);
}

.course-status:hover {
  transform: scale(1.05);
}

.status-completed {
  background: rgba(40, 167, 69, 0.9);
  color: white;
  box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
}

.status-progress,
.status-attended {
  background: rgba(23, 162, 184, 0.9);
  color: white;
  box-shadow: 0 4px 12px rgba(23, 162, 184, 0.3);
}

.status-upcoming {
  background: rgba(26, 91, 62, 0.9);
  color: white;
  box-shadow: 0 4px 12px rgba(26, 91, 62, 0.3);
}

.status-needs-action {
  background: rgba(255, 193, 7, 0.9);
  color: var(--text-dark);
  box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
  animation: statusPulse 2s ease-in-out infinite;
}

@keyframes statusPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

/* Linked Course Badge */
.linked-course-badge {
  position: absolute;
  top: 20px;
  left: 20px;
  background: var(--gradient-secondary);
  color: var(--text-dark);
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 6px;
  box-shadow: 0 4px 12px rgba(255, 204, 0, 0.4);
  border: 2px solid rgba(255, 255, 255, 0.3);
  z-index: 5;
  animation: linkedBadgeGlow 3s ease-in-out infinite alternate;
}

@keyframes linkedBadgeGlow {
  from { box-shadow: 0 4px 12px rgba(255, 204, 0, 0.4); }
  to { box-shadow: 0 6px 16px rgba(255, 204, 0, 0.6); }
}

.linked-course-text {
  white-space: nowrap;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Course Title and Meta */
.course-title {
  font-size: clamp(1.4rem, 2.5vw, 1.8rem);
  font-weight: 800;
  margin: 20px 0 20px 0;
  line-height: 1.2;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  position: relative;
  z-index: 2;
}

.course-code {
  color: rgba(255, 255, 255, 0.8);
  font-size: 0.9rem;
  font-weight: 500;
  margin: 0 0 15px 0;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.course-meta {
  opacity: 0.95;
  font-size: 0.95rem;
  line-height: 1.8;
  font-weight: 400;
  position: relative;
  z-index: 2;
}

.course-meta i {
  margin-right: 10px;
  opacity: 0.9;
  width: 16px;
  color: var(--secondary-color);
}

/* Course Body */
.course-body {
  padding: 40px;
  position: relative;
  z-index: 1;
}

.course-description {
  color: var(--text-medium);
  margin-bottom: 30px;
  line-height: 1.7;
  font-size: 1.05rem;
  font-weight: 400;
}

/* Enhanced Course Info Grid */
.course-info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  margin: 30px 0;
  padding: 30px;
  background: linear-gradient(135deg, rgba(0, 33, 71, 0.02), rgba(255, 204, 0, 0.02));
  border-radius: var(--border-radius-lg);
  border: 2px solid var(--border-color);
  position: relative;
  overflow: hidden;
}

.course-info-grid::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--gradient-secondary);
  border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
}

.course-info-item {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 20px 15px;
  background: var(--bg-primary);
  border-radius: var(--border-radius-md);
  border: 1px solid var(--border-color);
  transition: var(--transition-smooth);
  position: relative;
}

.course-info-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--gradient-accent);
  border-radius: var(--border-radius-md) var(--border-radius-md) 0 0;
  transform: scaleX(0);
  transition: var(--transition-smooth);
}

.course-info-item:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-sm);
  border-color: var(--secondary-color);
}

.course-info-item:hover::before {
  transform: scaleX(1);
}

.info-label {
  font-size: 0.8rem;
  color: var(--text-light);
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.info-label i {
  color: var(--primary-color);
  font-size: 0.9rem;
}

.info-value {
  font-size: 0.95rem;
  color: var(--text-dark);
  font-weight: 600;
  line-height: 1.4;
}

/* Linked Course Info Section */
.linked-course-info {
  margin: 30px 0;
  animation: linkedCourseGlow 4s ease-in-out infinite alternate;
  position: relative;
  overflow: hidden;
}

.linked-course-info > div {
  position: relative;
  z-index: 2;
}

.linked-course-info::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 5px;
  background: var(--gradient-secondary);
  border-radius: var(--border-radius-md) var(--border-radius-md) 0 0;
  animation: shimmerGold 2s linear infinite;
}

@keyframes linkedCourseGlow {
  from { box-shadow: 0 0 15px rgba(23, 162, 184, 0.3); }
  to { box-shadow: 0 0 25px rgba(255, 204, 0, 0.4); }
}

@keyframes shimmerGold {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

.linked-course-info h5 {
  color: var(--primary-color);
  margin: 0 0 20px 0;
  font-size: 1.3rem;
  font-weight: 800;
  display: flex;
  align-items: center;
  gap: 10px;
}

.linked-course-info h5 i {
  color: var(--secondary-color);
  font-size: 1.4rem;
}

/* Enhanced Material Section */
.video-section {
  margin-top: 35px;
}

.video-section h4 {
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--text-dark);
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 15px 0;
  border-bottom: 2px solid var(--border-color);
}

.video-section h4 i {
  color: var(--secondary-color);
  font-size: 1.3rem;
}

.video-list {
  max-height: 450px;
  overflow-y: auto;
  border: 2px solid var(--border-color);
  border-radius: var(--border-radius-lg);
  background: var(--bg-primary);
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.06);
}

.video-list::-webkit-scrollbar {
  width: 10px;
}

.video-list::-webkit-scrollbar-track {
  background: var(--bg-tertiary);
  border-radius: 5px;
  margin: 5px;
}

.video-list::-webkit-scrollbar-thumb {
  background: var(--gradient-secondary);
  border-radius: 5px;
  border: 2px solid var(--bg-tertiary);
}

.video-list::-webkit-scrollbar-thumb:hover {
  background: var(--gradient-gold);
}

/* Enhanced Video Item */
.video-item {
  display: grid;
  grid-template-columns: auto 1fr auto;
  grid-template-areas: "number info actions";
  align-items: center;
  gap: 20px;
  padding: 20px 25px;
  border-bottom: 1px solid var(--border-color);
  transition: var(--transition-smooth);
  position: relative;
  min-height: 90px;
}

.video-item::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 5px;
  background: transparent;
  transition: var(--transition-smooth);
}

.video-item:hover {
  background: linear-gradient(135deg, rgba(0, 33, 71, 0.02), rgba(255, 204, 0, 0.02));
  transform: translateX(5px);
}

.video-item:hover::before {
  background: var(--gradient-secondary);
}

.video-item:last-child {
  border-bottom: none;
}

.video-number {
  grid-area: number;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: var(--gradient-accent);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  font-weight: 800;
  color: white;
  flex-shrink: 0;
  transition: var(--transition-smooth);
  border: 3px solid var(--border-color);
  box-shadow: var(--shadow-xs);
}

.video-number:hover {
  transform: scale(1.1) rotate(5deg);
  box-shadow: var(--shadow-sm);
}

.video-info {
  grid-area: info;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.video-title {
  font-weight: 700;
  color: var(--text-dark);
  font-size: 1rem;
  line-height: 1.4;
  margin: 0;
}

.video-meta {
  font-size: 0.85rem;
  color: var(--text-light);
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

.video-meta i {
  color: var(--primary-color);
}

.video-actions {
  grid-area: actions;
  display: flex;
  flex-direction: column;
  gap: 8px;
  align-items: stretch;
  min-width: 120px;
}

.video-action {
  padding: 8px 16px;
  border-radius: var(--border-radius-sm);
  font-size: 0.8rem;
  font-weight: 700;
  text-decoration: none;
  transition: var(--transition-smooth);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  white-space: nowrap;
  border: 2px solid transparent;
  text-align: center;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.action-watch {
  background: var(--gradient-primary);
  color: white;
  border-color: var(--primary-color);
}

.action-watch:hover {
  background: var(--primary-color);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 33, 71, 0.3);
}

.action-exam,
.action-view {
  background: var(--gradient-secondary);
  color: var(--text-dark);
  border-color: var(--secondary-color);
}

.action-exam:hover,
.action-view:hover {
  background: var(--gold-dark);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(255, 204, 0, 0.4);
}

.action-review {
  background: linear-gradient(135deg, var(--info-color), #20c997);
  color: white;
  border-color: var(--info-color);
}

.action-review:hover {
  background: var(--info-color);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(23, 162, 184, 0.3);
}

/* Professional Action Buttons */
.course-actions {
  display: flex;
  gap: 15px;
  margin-top: 35px;
  align-items: center;
  flex-wrap: wrap;
}

.cta-btn {
  flex: 1;
  min-width: 180px;
  padding: 18px 30px;
  border: none;
  border-radius: var(--border-radius-md);
  font-size: 1rem;
  font-weight: 700;
  text-decoration: none;
  text-align: center;
  transition: var(--transition-smooth);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  position: relative;
  overflow: hidden;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  border: 2px solid transparent;
}

.cta-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: var(--transition-smooth);
}

.cta-btn:hover::before {
  left: 100%;
}

.btn-primary {
  background: var(--gradient-primary);
  color: white;
  border-color: var(--primary-color);
}

.btn-primary:hover {
  background: var(--primary-color);
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(0, 33, 71, 0.3);
}

.btn-secondary {
  background: var(--bg-secondary);
  color: var(--primary-color);
  border-color: var(--primary-color);
}

.btn-secondary:hover {
  background: var(--primary-color);
  color: white;
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(0, 33, 71, 0.2);
}

.btn-certificate {
  background: var(--gradient-gold) !important;
  color: var(--text-dark) !important;
  font-weight: 900 !important;
  box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4) !important;
  border-color: var(--gold-dark) !important;
  animation: certificateGlow 3s ease-in-out infinite alternate;
}

@keyframes certificateGlow {
  from { box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4); }
  to { box-shadow: 0 8px 28px rgba(255, 215, 0, 0.6); }
}

.btn-certificate:hover {
  background: var(--gold-dark) !important;
  color: white !important;
  transform: translateY(-4px) scale(1.02) !important;
  box-shadow: 0 10px 32px rgba(255, 215, 0, 0.5) !important;
}

.btn-generate-certificate {
  background: var(--gradient-secondary) !important;
  color: var(--text-dark) !important;
  animation: pulse-certificate 2s ease-in-out infinite;
  font-weight: 900 !important;
}

@keyframes pulse-certificate {
  0%, 100% { 
    box-shadow: 0 0 0 0 rgba(255, 204, 0, 0.7), 0 6px 20px rgba(255, 204, 0, 0.3); 
  }
  50% { 
    box-shadow: 0 0 0 15px rgba(255, 204, 0, 0), 0 8px 24px rgba(255, 204, 0, 0.4); 
  }
}

.btn-confirm-attendance {
  background: linear-gradient(135deg, var(--info-color), #20c997) !important;
  color: white !important;
}

.btn-confirm-attendance:hover {
  background: var(--info-color) !important;
  transform: translateY(-4px) !important;
  box-shadow: 0 8px 24px rgba(23, 162, 184, 0.3) !important;
}

.btn-warning {
  background: linear-gradient(135deg, var(--warning-color), #f8b500);
  color: var(--text-dark);
  border-color: var(--warning-color);
}

.btn-warning:hover {
  background: #f8b500;
  color: white;
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(255, 193, 7, 0.3);
}

.btn-success {
  background: linear-gradient(135deg, var(--success-color), #20c997);
  color: white;
  border-color: var(--success-color);
}

.btn-success:hover {
  background: var(--success-color);
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(40, 167, 69, 0.3);
}

.btn-outline-secondary {
  background: transparent;
  color: var(--text-medium);
  border-color: var(--border-color);
}

.btn-outline-secondary:hover {
  background: var(--bg-secondary);
  color: var(--text-dark);
  border-color: var(--primary-color);
  transform: translateY(-2px);
}

/* Certificate Status Section */
.certificate-status-section {
  border-left: 5px solid var(--secondary-color);
  transition: var(--transition-smooth);
  position: relative;
}

.certificate-status-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: -5px;
  width: 5px;
  height: 100%;
  background: var(--gradient-gold);
  animation: progressGlow 2s ease-in-out infinite alternate;
}

@keyframes progressGlow {
  from { opacity: 0.5; }
  to { opacity: 1; }
}

.certificate-status-section:hover {
  border-left-color: var(--gold-dark);
  box-shadow: 0 4px 16px rgba(255, 204, 0, 0.1);
  transform: translateX(3px);
}

/* Assessment Section Styling */
.course-info-section {
  margin: 25px 0;
  transition: var(--transition-smooth);
}

.course-info-section h5 {
  margin: 0 0 20px 0;
  font-size: 1.2rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 10px;
  color: var(--text-dark);
}

.course-info-section h5 i {
  color: var(--secondary-color);
  font-size: 1.3rem;
}

/* Empty State Enhancement */
.empty-state {
  text-align: center;
  padding: 100px 40px;
  background: var(--bg-primary);
  border-radius: var(--border-radius-xl);
  box-shadow: var(--shadow-lg);
  border: 2px solid var(--border-color);
  animation: fadeInUp 1s ease-out;
  position: relative;
  overflow: hidden;
}

.empty-state::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 5px;
  background: var(--gradient-secondary);
  border-radius: var(--border-radius-xl) var(--border-radius-xl) 0 0;
}

.empty-state i {
  font-size: 5rem;
  color: var(--text-muted);
  margin-bottom: 30px;
  opacity: 0.6;
}

.empty-state h3 {
  font-size: 1.8rem;
  margin-bottom: 20px;
  color: var(--text-dark);
  font-weight: 700;
}

.empty-state p {
  font-size: 1.1rem;
  margin-bottom: 40px;
  line-height: 1.7;
  color: var(--text-medium);
  max-width: 500px;
  margin-left: auto;
  margin-right: auto;
}

/* Loading States */
.loading {
  pointer-events: none;
  opacity: 0.7;
  position: relative;
}

.loading::after {
  content: '';
  position: absolute;
  width: 20px;
  height: 20px;
  margin: auto;
  border: 3px solid transparent;
  border-top-color: currentColor;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

@keyframes spin {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Responsive Design */
@media (max-width: 1200px) {
  .course-list {
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 35px;
  }
  
  .stats-grid {
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  }
}

@media (max-width: 992px) {
  .course-list {
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
  }
  
  .library-stats {
    padding: 40px 25px;
    margin: -60px auto 60px;
  }
  
  .stats-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 25px;
  }
  
  .course-info-grid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    padding: 25px;
  }
}

@media (max-width: 768px) {
  .hero-content {
    padding: 0 20px;
  }

  .course-list {
    grid-template-columns: 1fr;
    gap: 25px;
  }

  .course-actions {
    flex-direction: column;
    gap: 12px;
  }

  .cta-btn {
    min-width: 100%;
  }

  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }

  .video-item {
    grid-template-columns: auto 1fr;
    grid-template-areas: 
      "number info"
      "actions actions";
    gap: 15px;
    padding: 18px 20px;
  }

  .video-actions {
    flex-direction: row;
    gap: 10px;
    justify-content: center;
  }

  .course-header {
    padding: 30px;
    min-height: 180px;
  }

  .course-body {
    padding: 30px;
  }

  .library-stats {
    margin: -50px auto 50px;
    padding: 30px 20px;
  }

  .course-info-grid {
    grid-template-columns: 1fr;
    gap: 12px;
    padding: 20px;
  }

  .linked-course-badge,
  .course-status {
    position: static;
    margin-bottom: 15px;
    align-self: flex-start;
  }
}

@media (max-width: 480px) {
  .stats-grid {
    grid-template-columns: 1fr;
    gap: 15px;
  }

  .video-list {
    max-height: 350px;
  }

  .video-item {
    padding: 15px;
    gap: 12px;
  }

  .video-number {
    width: 40px;
    height: 40px;
    font-size: 0.9rem;
  }

  .cta-btn {
    padding: 16px 24px;
    font-size: 0.9rem;
  }

  .course-header {
    padding: 25px;
    min-height: 160px;
  }

  .empty-state {
    padding: 60px 20px;
  }

  .empty-state i {
    font-size: 4rem;
  }
}

/* Focus and Accessibility */
.cta-btn:focus,
.video-action:focus {
  outline: 3px solid var(--secondary-color);
  outline-offset: 3px;
}

.course-card:focus {
  outline: 3px solid var(--secondary-color);
  outline-offset: 3px;
}

/* Print Styles */
@media print {
  .hero-content,
  .library-stats,
  .video-actions,
  .course-actions,
  .linked-course-badge,
  .course-status {
    display: none;
  }
  
  .course-card {
    break-inside: avoid;
    box-shadow: none;
    border: 2px solid var(--primary-color);
    margin-bottom: 30px;
  }
  
  .course-header {
    background: var(--bg-secondary) !important;
    color: var(--text-dark) !important;
  }
  
  .linked-course-info {
    border: 3px solid var(--secondary-color) !important;
    animation: none !important;
  }
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
  :root {
    --bg-primary: #1a1a1a;
    --bg-secondary: #2d2d2d;
    --bg-tertiary: #3a3a3a;
    --text-dark: #ffffff;
    --text-medium: #e0e0e0;
    --text-light: #b0b0b0;
    --border-color: #404040;
  }
  
  .course-card {
    background: var(--bg-primary);
    border-color: var(--border-color);
  }
  
  .video-list {
    background: var(--bg-primary);
  }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
  .course-card {
    border: 3px solid var(--primary-color);
  }
  
  .cta-btn {
    border: 3px solid currentColor;
  }
  
  .linked-course-badge,
  .course-status {
    border: 3px solid white;
    font-weight: 900;
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
  
  .course-card:hover,
  .cta-btn:hover,
  .video-item:hover {
    transform: none !important;
  }
}
  </style>
</head>

<body>
  <%- include('partials/header') %>

  <!-- Hero Section -->
  <section id="hero">
    <div class="hero-content">
      <h1><i class="fas fa-users"></i> In-Person Training Library</h1>
      <p>Access your in-person training courses, materials, and certificates.</p>
    </div>
  </section>

  <!-- Statistics Section -->
  <section class="library-stats">
    <div class="stats-grid <%= linkedCourses > 0 ? 'has-linked' : '' %>">
      <div class="stat-item">
        <div class="stat-number"><%= totalCourses %></div>
        <div class="stat-label">Total Courses</div>
      </div>
      <div class="stat-item">
        <div class="stat-number"><%= attendedCourses %></div>
        <div class="stat-label">Attended</div>
      </div>
      <div class="stat-item">
        <div class="stat-number"><%= upcomingCourses %></div>
        <div class="stat-label">Upcoming</div>
      </div>
      <div class="stat-item">
        <div class="stat-number"><%= completedCourses %></div>
        <div class="stat-label">Certificates</div>
      </div>
      <% if (linkedCourses > 0) { %>
        <div class="stat-item">
          <div class="stat-number"><%= linkedCourses %></div>
          <div class="stat-label">Linked Programs</div>
        </div>
      <% } %>
    </div>
  </section>

  <!-- Library Navigation Tabs -->
  <section style="max-width: 1400px; margin: 0 auto 40px; padding: 0 20px;">
    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
      <a href="/library/self-paced" class="cta-btn btn-secondary">
        <i class="fas fa-play-circle"></i> Self-Paced Courses
      </a>
      <a href="/library/live" class="cta-btn btn-secondary">
        <i class="fas fa-video"></i> Live Online Courses
      </a>
      <a href="/library/in-person" class="cta-btn btn-primary">
        <i class="fas fa-users"></i> In-Person Courses
      </a>
    </div>
  </section>

  <!-- Filter and Search Section -->
  <section style="max-width: 1400px; margin: 0 auto 30px; padding: 0 20px;">
    <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end;">
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Search Courses</label>
          <input type="text" id="courseSearch" placeholder="Search by title, location, instructor..." 
                 style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
        </div>
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Status Filter</label>
          <select id="statusFilter" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
            <option value="">All Statuses</option>
            <option value="upcoming">Upcoming</option>
            <option value="completed">Completed</option>
            <option value="attended">Attended</option>
            <option value="needs-action">Needs Action</option>
          </select>
        </div>
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Sort By</label>
          <select id="sortBy" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px;">
            <option value="date-desc">Newest First</option>
            <option value="date-asc">Oldest First</option>
            <option value="title">Title A-Z</option>
            <option value="status">Status</option>
          </select>
        </div>
        <div>
          <button onclick="clearFilters()" style="width: 100%; padding: 10px; background: #6c757d; color: white; border: none; border-radius: 8px; font-weight: 600;">
            <i class="fas fa-times"></i> Clear
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Library Content Section -->
  <section id="library-content">
    <div class="section-header">
      <h2>Your In-Person Training Courses</h2>
      <p>Manage your attendance and access course materials</p>
    </div>

    <% if (myCourses && myCourses.length > 0) { %>
      <div class="course-list" id="courseList">
        <% myCourses.forEach((course, index) => { %>
          <div class="course-card <%= course.canViewCertificate ? 'completed' : (course.attendanceConfirmed ? 'in-progress' : (new Date(course.startDate) > new Date() ? 'upcoming' : 'needs-action')) %>" 
               style="--card-index: <%= index %>"
               data-title="<%= course.title %>" 
               data-location="<%= course.location %>" 
               data-instructor="<%= course.instructor %>"
               data-status="<%= course.canViewCertificate ? 'completed' : (course.attendanceConfirmed ? 'attended' : (new Date(course.startDate) > new Date() ? 'upcoming' : 'needs-action')) %>"
               data-date="<%= course.startDate %>">
            
            <!-- Enhanced Course Header -->
            <div class="course-header">
              <div class="course-status <%= course.canViewCertificate ? 'status-completed' : (course.attendanceConfirmed ? 'status-progress' : (new Date(course.startDate) > new Date() ? 'status-upcoming' : 'status-needs-action')) %>">
                <% if (course.canViewCertificate) { %>
                  <i class="fas fa-medal"></i> Certified
                <% } else if (course.attendanceConfirmed && !course.canViewCertificate) { %>
                  <% if (course.assessmentRequired && !course.assessmentCompleted) { %>
                    <i class="fas fa-clipboard-question"></i> Assessment Pending
                  <% } else if (course.assessmentRequired && !course.assessmentPassed) { %>
                    <i class="fas fa-times-circle"></i> Assessment Failed
                  <% } else { %>
                    <i class="fas fa-hourglass-half"></i> Processing
                  <% } %>
                <% } else if (new Date(course.startDate) > new Date()) { %>
                  <i class="fas fa-calendar-alt"></i> Upcoming
                <% } else if (course.courseEnded) { %>
                  <i class="fas fa-exclamation-circle"></i> Action Required
                <% } else { %>
                  <i class="fas fa-clock"></i> In Progress
                <% } %>
              </div>
              
              <!-- NEW: Linked Course Badge for IN-PERSON courses -->
              <% if (course.linkedCourse && course.linkedCourse.isLinked) { %>
                <div class="linked-course-badge">
                  <i class="fas fa-link"></i>
                  <span class="linked-course-text">Linked to Online</span>
                </div>
              <% } %>
              
              <h3 class="course-title"><%= course.title %></h3>
              <p class="course-code">Course Code: <%= course.courseCode %></p>
              <div class="course-meta">
                <i class="fas fa-calendar"></i> <%= new Date(course.startDate).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %>
                <% if (course.endDate && course.endDate !== course.startDate) { %>
                  - <%= new Date(course.endDate).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %>
                <% } %>
                <br>
                <i class="fas fa-map-marker-alt"></i> <%= course.location %> - <%= course.venue %>
                <br>
                <i class="fas fa-user-tie"></i> Instructor: <%= course.instructor || 'IAAI Team' %>
                <% if (course.duration) { %>
                  <br>
                  <i class="fas fa-clock"></i> Duration: <%= course.duration %>
                <% } %>
              </div>
            </div>

            <!-- Course Body -->
            <div class="course-body">
              <!-- Course Description -->
              <p class="course-description"><%= course.description %></p>

              <!-- Course Information Grid -->
              <div class="course-info-grid">
                <div class="course-info-item">
                  <div class="info-label">
                    <i class="fas fa-chalkboard-teacher"></i> Instructor
                  </div>
                  <div class="info-value"><%= course.instructor || 'IAAI Team' %></div>
                </div>
                
                <div class="course-info-item">
                  <div class="info-label">
                    <i class="fas fa-calendar"></i> Start Date
                  </div>
                  <div class="info-value">
                    <%= new Date(course.startDate).toLocaleDateString() %>
                  </div>
                </div>
                
                <div class="course-info-item">
                  <div class="info-label">
                    <i class="fas fa-map-marker-alt"></i> Location
                  </div>
                  <div class="info-value"><%= course.location %></div>
                </div>
                
                <div class="course-info-item">
                  <div class="info-label">
                    <i class="fas fa-building"></i> Venue
                  </div>
                  <div class="info-value"><%= course.venue %></div>
                </div>
                
                <% if (course.courseEnded) { %>
                  <div class="course-info-item">
                    <div class="info-label">
                      <i class="fas fa-calendar-check"></i> End Date
                    </div>
                    <div class="info-value">
                      <%= new Date(course.endDate || course.startDate).toLocaleDateString() %>
                    </div>
                  </div>
                <% } %>
                
                <div class="course-info-item">
                  <div class="info-label">
                    <i class="fas fa-users"></i> Attendance
                  </div>
                  <div class="info-value">
                    <% if (course.attendanceConfirmed) { %>
                      <span style="color: #28a745; font-weight: 600;">
                        <i class="fas fa-check-circle"></i> Confirmed
                      </span>
                    <% } else { %>
                      <span style="color: #dc3545;">
                        <i class="fas fa-times-circle"></i> Not Confirmed
                      </span>
                    <% } %>
                  </div>
                </div>
              </div>

              <!-- NEW: Linked Course Information for IN-PERSON -->
              <% if (course.linkedCourse && course.linkedCourse.isLinked) { %>
                <div class="linked-course-info" style="margin: 20px 0;">
                  <div style="background: linear-gradient(135deg, #e8f4f8 0%, #f0f8ff 100%); padding: 20px; border-radius: 12px; border: 2px solid #17a2b8;">
                    <h5 style="color: #17a2b8; margin: 0 0 15px 0; font-size: 1.2rem;">
                      <i class="fas fa-link"></i> Multi-Component Training Program
                    </h5>
                    
                    <div style="background: rgba(255,255,255,0.7); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                      <div style="color: #17a2b8; font-weight: 600;">
                        <i class="fas fa-info-circle"></i> <strong>This in-person course is part of a comprehensive training program:</strong>
                      </div>
                      <div style="margin-top: 10px; color: #0c5460;">
                        <i class="fas fa-users" style="color: #17a2b8; width: 20px;"></i> <strong>In-Person Component:</strong> <%= course.title %><br>
                        <i class="fas fa-laptop" style="color: #17a2b8; width: 20px;"></i> <strong>Online Component:</strong> <%= course.linkedCourse.linkedCourseTitle || 'Virtual Training' %>
                        <% if (course.linkedCourse.linkedCoursePlatform) { %>
                          <br><i class="fas fa-video" style="color: #17a2b8; width: 20px;"></i> <strong>Platform:</strong> <%= course.linkedCourse.linkedCoursePlatform %>
                        <% } %>
                        <% if (course.linkedCourse.linkedCourseCode) { %>
                          <br><i class="fas fa-code" style="color: #17a2b8; width: 20px;"></i> <strong>Online Course Code:</strong> <%= course.linkedCourse.linkedCourseCode %>
                        <% } %>
                      </div>
                    </div>

                    <% if (course.linkedCourse.linkType) { %>
                      <div style="background: rgba(23, 162, 184, 0.1); padding: 12px; border-radius: 8px;">
                        <div style="color: #0c5460; font-size: 0.9rem;">
                          <% if (course.linkedCourse.linkType === "prerequisite") { %>
                            <i class="fas fa-arrow-right"></i> <strong>Online Prerequisite:</strong> The online component should be completed before this in-person training.
                          <% } else if (course.linkedCourse.linkType === "follow-up") { %>
                            <i class="fas fa-graduation-cap"></i> <strong>Follow-up Training:</strong> This in-person course builds upon the online foundation.
                          <% } else { %>
                            <i class="fas fa-link"></i> <strong>Linked Training:</strong> Part of a comprehensive learning program.
                          <% } %>
                        </div>
                      </div>
                    <% } %>
                  </div>
                </div>
              <% } %>

              <!-- Assessment Information (if required) -->
 <!-- Assessment Information (Enhanced) -->
<% if (course.assessmentRequired) { %>
  <div class="course-info-section" style="margin: 20px 0;">
    <h5 style="color: #333; margin-bottom: 10px;">
      <i class="fas fa-clipboard-check"></i> Assessment Status
    </h5>
    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
      
      <% if (course.assessmentCompleted && course.assessmentPassed) { %>
        <!-- ✅ ASSESSMENT PASSED -->
        <div style="color: #28a745; font-weight: 600;">
          <i class="fas fa-trophy"></i> Assessment Completed Successfully
          <span style="float: right; font-weight: normal;">
            Score: <%= course.assessmentScore %>% (Required: <%= course.passingScore || 70 %>%)
          </span>
        </div>
        <div style="margin-top: 10px; color: #666; font-size: 0.9rem;">
          <i class="fas fa-calendar-check"></i> Completed: <%= course.lastAssessmentDate ? new Date(course.lastAssessmentDate).toLocaleDateString() : 'Recently' %><br>
          <i class="fas fa-redo"></i> Attempts Used: <%= course.currentAttempts %> of <%= course.maxAttempts %>
        </div>
        
      <% } else if (course.hasAttempted && !course.assessmentPassed) { %>
        <!-- ❌ ASSESSMENT FAILED -->
        <div style="color: #dc3545; font-weight: 600;">
          <i class="fas fa-times-circle"></i> Assessment Not Passed
          <span style="float: right; font-weight: normal;">
            Score: <%= course.assessmentScore %>% (Required: <%= course.passingScore || 70 %>%)
          </span>
        </div>
        <div style="margin-top: 10px; color: #666; font-size: 0.9rem;">
          <i class="fas fa-calendar-times"></i> Last Attempt: <%= course.lastAssessmentDate ? new Date(course.lastAssessmentDate).toLocaleDateString() : 'Recently' %><br>
          <i class="fas fa-redo"></i> Attempts: <%= course.currentAttempts %> of <%= course.maxAttempts %>
          <% if (course.canRetake) { %>
            <br><span style="color: #ffc107;"><i class="fas fa-info-circle"></i> You can retake the assessment</span>
          <% } %>
        </div>
        
      <% } else { %>
        <!-- ⏳ ASSESSMENT PENDING -->
        <div style="color: #ffc107; font-weight: 600;">
          <i class="fas fa-clock"></i> Assessment Pending
          <span style="float: right; font-weight: normal;">
            Required: <%= course.passingScore || 70 %>%
          </span>
        </div>
        <div style="margin-top: 10px; color: #666; font-size: 0.9rem;">
          Assessment Type: <%= course.assessmentType ? course.assessmentType.charAt(0).toUpperCase() + course.assessmentType.slice(1) : 'Quiz' %>
          <br>Attempts available: <%= course.maxAttempts %>
        </div>
      <% } %>
    </div>
  </div>
<% } %>

              <!-- Course Registration Information -->
              <div class="course-info-section" style="margin: 20px 0;">
                <h5 style="color: #333; margin-bottom: 10px;">
                  <i class="fas fa-info-circle"></i> Registration Information
                </h5>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                  <div style="display: grid; gap: 10px;">
                    <div><i class="fas fa-calendar-check" style="color: #17a2b8; width: 20px;"></i> <strong>Registered:</strong> <%= new Date(course.dateOfRegistration).toLocaleDateString() %></div>
                    <% if (course.status) { %>
                      <div><i class="fas fa-flag" style="color: #17a2b8; width: 20px;"></i> <strong>Status:</strong> <%= course.status.charAt(0).toUpperCase() + course.status.slice(1) %></div>
                    <% } %>
                    <% if (course.duration) { %>
                      <div><i class="fas fa-clock" style="color: #17a2b8; width: 20px;"></i> <strong>Duration:</strong> <%= course.duration %></div>
                    <% } %>
                  </div>
                </div>
              </div>

              <!-- Course Materials Section -->
              <% 
                const hasDocuments = course.media?.documents?.length > 0;
                const hasImages = course.media?.images?.length > 0;
                const hasVideos = course.media?.videos?.length > 0;
                const hasLinks = course.media?.links?.length > 0;
                const hasPromotional = course.media?.promotional?.brochureUrl || 
                                     course.media?.promotional?.videoUrl || 
                                     course.media?.promotional?.catalogUrl;
                const hasAnyMaterials = hasDocuments || hasImages || hasVideos || hasPromotional || hasLinks;
              %>

              <% if (hasAnyMaterials) { %>
                <div class="video-section">
                  <h4><i class="fas fa-folder-open"></i> Course Materials</h4>
                  <div class="video-list">
                    
                    <!-- Documents -->
                    <% if (hasDocuments) { %>
                      <% course.media.documents.forEach((docUrl, index) => { %>
                        <% 
                          const fileName = docUrl.split('/').pop() || `Document ${index + 1}`;
                          const fileExt = fileName.split('.').pop().toLowerCase();
                          let icon = 'fa-file';
                          let fileType = 'Document';
                          let bgColor = '#6c757d';
                          
                          if (['ppt', 'pptx'].includes(fileExt)) {
                            icon = 'fa-file-powerpoint';
                            fileType = 'Presentation';
                            bgColor = '#dc3545';
                          } else if (['doc', 'docx'].includes(fileExt)) {
                            icon = 'fa-file-word';
                            fileType = 'Word Document';
                            bgColor = '#0066cc';
                          } else if (fileExt === 'pdf') {
                            icon = 'fa-file-pdf';
                            fileType = 'PDF Document';
                            bgColor = '#dc3545';
                          } else if (['xls', 'xlsx'].includes(fileExt)) {
                            icon = 'fa-file-excel';
                            fileType = 'Spreadsheet';
                            bgColor = '#28a745';
                          }
                        %>
                        <div class="video-item">
                          <div class="video-number" style="background: <%= bgColor %>;">
                            <i class="fas <%= icon %>"></i>
                          </div>
                          <div class="video-info">
                            <div class="video-title"><%= fileName %></div>
                            <div class="video-meta">
                              <i class="fas <%= icon %>"></i> <%= fileType %>
                            </div>
                          </div>
                          <div class="video-actions">
                            <a href="<%= docUrl %>" target="_blank" class="video-action action-watch">
                              <i class="fas fa-download"></i> Download
                            </a>
                            <a href="<%= docUrl %>" target="_blank" class="video-action action-exam">
                              <i class="fas fa-eye"></i> View
                            </a>
                          </div>
                        </div>
                      <% }) %>
                    <% } %>
                    
                    <!-- Videos -->
                    <% if (hasVideos) { %>
                      <% course.media.videos.forEach((videoUrl, index) => { %>
                        <% 
                          const videoName = videoUrl.split('/').pop() || `Video ${index + 1}`;
                          const isYouTube = videoUrl.includes('youtube.com') || videoUrl.includes('youtu.be');
                          const isVimeo = videoUrl.includes('vimeo.com');
                        %>
                        <div class="video-item">
                          <div class="video-number" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                            <i class="fas fa-play-circle"></i>
                          </div>
                          <div class="video-info">
                            <div class="video-title"><%= videoName %></div>
                            <div class="video-meta">
                              <i class="fas fa-video"></i> Video Material
                              <% if (isYouTube) { %>
                                • <i class="fab fa-youtube"></i> YouTube
                              <% } else if (isVimeo) { %>
                                • <i class="fab fa-vimeo"></i> Vimeo
                              <% } %>
                            </div>
                          </div>
                          <div class="video-actions">
                            <a href="<%= videoUrl %>" target="_blank" class="video-action action-watch">
                              <i class="fas fa-play"></i> Watch
                            </a>
                          </div>
                        </div>
                      <% }) %>
                    <% } %>

                    <!-- External Links -->
                    <% if (hasLinks) { %>
                      <% course.media.links.forEach((link, index) => { %>
                        <% 
                          let linkIcon = 'fa-link';
                          let linkColor = '#17a2b8';
                          
                          if (link.type === 'video') {
                            linkIcon = 'fa-play-circle';
                            linkColor = '#dc3545';
                          } else if (link.type === 'article') {
                            linkIcon = 'fa-newspaper';
                            linkColor = '#28a745';
                          } else if (link.type === 'tool') {
                            linkIcon = 'fa-tools';
                            linkColor = '#ffc107';
                          }
                        %>
                        <div class="video-item">
                          <div class="video-number" style="background: <%= linkColor %>;">
                            <i class="fas <%= linkIcon %>"></i>
                          </div>
                          <div class="video-info">
                            <div class="video-title"><%= link.title || `External Link ${index + 1}` %></div>
                            <div class="video-meta">
                              <i class="fas <%= linkIcon %>"></i> <%= link.type ? link.type.charAt(0).toUpperCase() + link.type.slice(1) : 'External Link' %>
                            </div>
                          </div>
                          <div class="video-actions">
                            <a href="<%= link.url %>" target="_blank" class="video-action action-watch">
                              <i class="fas fa-external-link-alt"></i> Open
                            </a>
                          </div>
                        </div>
                      <% }) %>
                    <% } %>
                    
                    <!-- Promotional Materials -->
                    <% if (hasPromotional) { %>
                      <% if (course.media.promotional.brochureUrl) { %>
                        <div class="video-item">
                          <div class="video-number" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                            <i class="fas fa-book-open"></i>
                          </div>
                          <div class="video-info">
                            <div class="video-title">Course Brochure</div>
                            <div class="video-meta">
                              <i class="fas fa-book-open"></i> Official Brochure
                            </div>
                          </div>
                          <div class="video-actions">
                            <a href="<%= course.media.promotional.brochureUrl %>" target="_blank" class="video-action action-exam">
                              <i class="fas fa-download"></i> Download
                            </a>
                            <a href="<%= course.media.promotional.brochureUrl %>" target="_blank" class="video-action action-review">
                              <i class="fas fa-eye"></i> View
                            </a>
                          </div>
                        </div>
                      <% } %>
                      
                      <% if (course.media.promotional.catalogUrl) { %>
                        <div class="video-item">
                          <div class="video-number" style="background: linear-gradient(135deg, #fa709a, #fee140);">
                            <i class="fas fa-book"></i>
                          </div>
                          <div class="video-info">
                            <div class="video-title">Course Catalog</div>
                            <div class="video-meta">
                              <i class="fas fa-book"></i> Full Catalog
                            </div>
                          </div>
                          <div class="video-actions">
                            <a href="<%= course.media.promotional.catalogUrl %>" target="_blank" class="video-action action-exam">
                              <i class="fas fa-download"></i> Download
                            </a>
                            <a href="<%= course.media.promotional.catalogUrl %>" target="_blank" class="video-action action-review">
                              <i class="fas fa-eye"></i> View
                            </a>
                          </div>
                        </div>
                      <% } %>
                      
                      <% if (course.media.promotional.videoUrl) { %>
                        <div class="video-item">
                          <div class="video-number" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                            <i class="fas fa-film"></i>
                          </div>
                          <div class="video-info">
                            <div class="video-title">Promotional Video</div>
                            <div class="video-meta">
                              <i class="fas fa-film"></i> Course Overview
                            </div>
                          </div>
                          <div class="video-actions">
                            <a href="<%= course.media.promotional.videoUrl %>" target="_blank" class="video-action action-watch">
                              <i class="fas fa-play"></i> Watch
                            </a>
                          </div>
                        </div>
                      <% } %>
                    <% } %>
                    
                    <!-- Gallery Images -->
                    <% if (hasImages) { %>
                      <div class="video-item">
                        <div class="video-number" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                          <i class="fas fa-images"></i>
                        </div>
                        <div class="video-info">
                          <div class="video-title">Course Gallery</div>
                          <div class="video-meta">
                            <i class="fas fa-images"></i> <%= course.media.images.length %> Image<%= course.media.images.length > 1 ? 's' : '' %>
                          </div>
                        </div>
                        <div class="video-actions">
                          <button class="video-action action-review" onclick="showImageGallery('<%= course.courseId %>')">
                            <i class="fas fa-eye"></i> View Gallery
                          </button>
                        </div>
                      </div>
                    <% } %>
                  </div>
                </div>
              <% } %>

              <!-- Course Status and Next Steps -->
              <!-- Course Status and Next Steps -->
<% if (course.courseEnded && !course.canViewCertificate) { %>
  <div class="course-info-section" style="margin: 20px 0;">
    
    <!-- Step 1: Attendance Confirmation (FIRST) -->
    <% if (!course.attendanceConfirmed) { %>
      <% if (course.canConfirmAttendance) { %>
        <!-- ✅ ATTENDANCE AVAILABLE -->
        <div style="background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); padding: 20px; border-radius: 12px; border: 2px solid #ffc107; margin-bottom: 15px;">
          <h5 style="color: #856404; margin: 0 0 10px 0;">
            <i class="fas fa-user-check"></i> Step 1: Confirm Your Attendance
          </h5>
          <p style="margin: 0 0 15px 0; color: #856404;">
            <% if (course.courseInProgress) { %>
              <i class="fas fa-clock"></i> Course is currently in progress. You can confirm your attendance now.
            <% } else if (course.courseEnded) { %>
              <i class="fas fa-calendar-times"></i> Course has ended. Please confirm your attendance within the grace period.
              <br><small>Grace period ends: <%= new Date(course.attendanceGracePeriodEnd).toLocaleDateString() %></small>
            <% } %>
          </p>
          <button class="cta-btn btn-confirm-attendance" 
                  data-course-id="<%= course.courseId %>"
                  data-course-type="<%= course.courseType %>"
                  style="margin: 0;">
            <i class="fas fa-check"></i> Confirm Attendance
          </button>
        </div>
      <% } else { %>
        <!-- ✅ GRACE PERIOD EXPIRED -->
        <div style="background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); padding: 20px; border-radius: 12px; border: 2px solid #dc3545; margin-bottom: 15px;">
          <h5 style="color: #721c24; margin: 0 0 10px 0;">
            <i class="fas fa-exclamation-triangle"></i> Step 1: Attendance Confirmation Expired
          </h5>
          <p style="margin: 0 0 15px 0; color: #721c24;">
            The grace period for confirming attendance has expired. Please contact support if you attended this course.
          </p>
          <a href="/contact" class="cta-btn btn-secondary" style="margin: 0;">
            <i class="fas fa-envelope"></i> Contact Support
          </a>
        </div>
      <% } %>
    <% } else { %>
      <!-- ✅ ATTENDANCE CONFIRMED -->
      <div style="background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); padding: 15px; border-radius: 12px; border: 2px solid #28a745; margin-bottom: 15px;">
        <h5 style="color: #155724; margin: 0 0 5px 0;">
          <i class="fas fa-check-circle"></i> Step 1: Attendance Confirmed ✅
        </h5>
        <p style="margin: 0; color: #155724; font-size: 0.9rem;">
          <% if (course.attendanceDate) { %>
            Confirmed on <%= new Date(course.attendanceDate).toLocaleDateString() %>
          <% } else { %>
            Attendance confirmed
          <% } %>
        </p>
      </div>
    <% } %>

    <!-- Step 2: Assessment (SECOND) -->
    <% if (course.assessmentRequired) { %>
      <div style="background: linear-gradient(135deg, #e8f4f8 0%, #f0f8ff 100%); padding: 20px; border-radius: 12px; border: 2px solid #17a2b8;">
        <h5 style="color: #17a2b8; margin: 0 0 15px 0;">
          <i class="fas fa-clipboard-check"></i> Step 2: Complete Assessment
          <% if (course.assessmentCompleted && course.assessmentPassed) { %>
            <span style="color: #28a745; font-size: 0.9rem; margin-left: 10px;">✅ COMPLETED</span>
          <% } %>
        </h5>
        <div style="display: grid; gap: 10px; margin-bottom: 15px;">
          <div><i class="fas fa-target" style="color: #17a2b8; width: 20px;"></i> <strong>Passing Score:</strong> <%= course.passingScore %>%</div>
          <div><i class="fas fa-question-circle" style="color: #17a2b8; width: 20px;"></i> <strong>Assessment Type:</strong> <%= course.assessmentType ? course.assessmentType.charAt(0).toUpperCase() + course.assessmentType.slice(1) : 'Quiz' %></div>
          <div><i class="fas fa-redo" style="color: #17a2b8; width: 20px;"></i> <strong>Attempts:</strong> <%= course.currentAttempts %> of <%= course.maxAttempts %></div>
        </div>
        
        <% if (course.assessmentCompleted && course.assessmentPassed) { %>
          <!-- COMPLETED STATE -->
          <div style="background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); padding: 15px; border-radius: 12px; border: 2px solid #28a745; margin-bottom: 15px;">
            <h6 style="color: #155724; margin: 0 0 10px 0;">
              <i class="fas fa-trophy"></i> Assessment Completed Successfully!
            </h6>
            <div style="color: #155724;">
              <i class="fas fa-check-circle"></i> <strong>Score:</strong> <%= course.assessmentScore %>% - <span style="color: #28a745; font-weight: 700;">PASSED</span><br>
              <% if (course.lastAssessmentDate) { %>
                <i class="fas fa-calendar-check"></i> <strong>Completed:</strong> <%= new Date(course.lastAssessmentDate).toLocaleDateString() %><br>
              <% } %>
              <i class="fas fa-redo"></i> <strong>Attempts Used:</strong> <%= course.currentAttempts %> of <%= course.maxAttempts %>
            </div>
          </div>
          
        <% } else if (course.assessmentCompleted && !course.assessmentPassed) { %>
          <!-- FAILED STATE -->
          <div style="background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); padding: 15px; border-radius: 12px; border: 2px solid #dc3545; margin-bottom: 15px;">
            <h6 style="color: #721c24; margin: 0 0 10px 0;">
              <i class="fas fa-times-circle"></i> Assessment Not Passed
            </h6>
            <div style="color: #721c24;">
              <i class="fas fa-chart-line"></i> <strong>Your Score:</strong> <%= course.assessmentScore %>%<br>
              <i class="fas fa-target"></i> <strong>Required:</strong> <%= course.passingScore %>%<br>
              <i class="fas fa-redo"></i> <strong>Attempts:</strong> <%= course.currentAttempts %> of <%= course.maxAttempts %>
              <% if (course.canRetake) { %>
                <br><span style="color: #ffc107;"><i class="fas fa-info-circle"></i> You can retake the assessment</span>
              <% } %>
            </div>
          </div>
          
          <% if (course.canRetake) { %>
            <a href="/library/in-person/assessment/<%= course.courseId %>" 
               class="cta-btn btn-warning" style="margin: 0;">
              <i class="fas fa-redo"></i> Retake Assessment
            </a>
          <% } %>
          
        <% } else { %>
          <!-- NOT STARTED STATE -->
          <p style="margin: 0 0 15px 0; color: #17a2b8;">
            <% if (!course.attendanceConfirmed) { %>
              <i class="fas fa-lock"></i> Complete Step 1 (Attendance) first to unlock assessment.
            <% } else { %>
              <i class="fas fa-play-circle"></i> Ready to take assessment.
            <% } %>
          </p>
          
          <% if (course.attendanceConfirmed) { %>
            <a href="/library/in-person/assessment/<%= course.courseId %>" 
               class="cta-btn btn-primary" style="margin: 0;">
              <i class="fas fa-clipboard-check"></i> Take Assessment
            </a>
          <% } else { %>
            <button class="cta-btn" 
                    style="background: #6c757d; color: white; cursor: not-allowed; margin: 0;" 
                    disabled>
              <i class="fas fa-lock"></i> Assessment Locked
            </button>
          <% } %>
        <% } %>
      </div>
    <% } else { %>
      <!-- No Assessment Required -->
      <% if (course.attendanceConfirmed && course.canGetCertificate) { %>
        <div style="background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); padding: 15px; border-radius: 12px; border: 2px solid #28a745; margin-bottom: 15px;">
          <h6 style="color: #155724; margin: 0 0 10px 0;">
            <i class="fas fa-check-circle"></i> Course Completed Successfully!
          </h6>
          <p style="margin: 0; color: #155724;">
            No assessment required for this course. You can now generate your certificate.
          </p>
        </div>
      <% } %>
    <% } %>
  </div>
<% } else if (!course.courseEnded) { %>
  <!-- Course Not Ended Yet -->
  <div class="course-info-section" style="margin: 20px 0;">
    <% if (course.courseNotStarted) { %>
      <!-- ✅ COURSE NOT STARTED -->
      <div style="background: linear-gradient(135deg, #e8f5e8 0%, #d4f4dd 100%); padding: 20px; border-radius: 12px; border: 2px solid #4caf50;">
        <h5 style="color: #2e7d32; margin: 0 0 15px 0;">
          <i class="fas fa-calendar-alt"></i> Course Schedule
        </h5>
        <div style="display: grid; gap: 10px;">
          <div><i class="fas fa-hourglass-start" style="color: #2e7d32; width: 20px;"></i> <strong>Status:</strong> Course starts in <%= Math.ceil((new Date(course.startDate) - new Date()) / (1000 * 60 * 60 * 24)) %> days</div>
          <div><i class="fas fa-calendar-alt" style="color: #2e7d32; width: 20px;"></i> <strong>Start Date:</strong> <%= new Date(course.startDate).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></div>
          <% if (course.endDate && course.endDate !== course.startDate) { %>
            <div><i class="fas fa-calendar-times" style="color: #2e7d32; width: 20px;"></i> <strong>End Date:</strong> <%= new Date(course.endDate).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></div>
          <% } %>
        </div>
        <div style="margin-top: 15px; color: #2e7d32; font-size: 0.9rem;">
          <i class="fas fa-info-circle"></i> Attendance confirmation will be available during and after the course.
        </div>
      </div>
    <% } else if (course.courseInProgress) { %>
      <!-- ✅ COURSE IN PROGRESS -->
      <div style="background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); padding: 20px; border-radius: 12px; border: 2px solid #ffc107;">
        <h5 style="color: #856404; margin: 0 0 15px 0;">
          <i class="fas fa-play-circle"></i> Course in Progress
        </h5>
        <div style="display: grid; gap: 10px;">
          <div><i class="fas fa-calendar-alt" style="color: #856404; width: 20px;"></i> <strong>Started:</strong> <%= new Date(course.startDate).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></div>
          <% if (course.endDate && course.endDate !== course.startDate) { %>
            <div><i class="fas fa-calendar-times" style="color: #856404; width: 20px;"></i> <strong>Ends:</strong> <%= new Date(course.endDate).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></div>
          <% } %>
        </div>
        <div style="margin-top: 15px; color: #856404; font-size: 0.9rem;">
          <i class="fas fa-info-circle"></i> You can confirm your attendance now or after the course ends.
        </div>
      </div>
    <% } %>
  </div>
<% } %>

<!-- Enhanced Action Buttons with Status-Aware Logic -->
<!-- Enhanced Action Buttons with CORRECTED Status-Aware Logic -->
<!-- Enhanced Action Buttons with FIXED Assessment Logic -->
<div class="course-actions">
  
  <!-- ========================================= -->
  <!-- ✅ ASSESSMENT RESULTS BUTTON (ALWAYS SHOWN WHEN COMPLETED) -->
  <!-- ========================================= -->
  <% if (course.assessmentRequired && course.assessmentCompleted) { %>
    <% if (course.assessmentPassed) { %>
      <!-- ✅ PASSED: Always show assessment results with success styling -->
      <a href="/library/in-person/assessment/<%= course.courseId %>" class="cta-btn btn-success">
        <i class="fas fa-trophy"></i> View Assessment Results 
        <small>(Passed: <%= course.assessmentScore %>%)</small>
      </a>
    <% } else { %>
      <!-- ❌ FAILED: Show assessment results with warning styling -->
      <a href="/library/in-person/assessment/<%= course.courseId %>" class="cta-btn btn-warning">
        <i class="fas fa-chart-line"></i> View Assessment Results 
        <small>(Score: <%= course.assessmentScore %>%)</small>
      </a>
    <% } %>
  <% } %>

  <!-- ========================================= -->
  <!-- ✅ CERTIFICATE BUTTONS (SEPARATE FROM ASSESSMENT) -->
  <!-- ========================================= -->
  
  <!-- Certificate Already Available -->
  <% if (course.canViewCertificate && course.hasCertificate) { %>
    <a href="/certificates/view/<%= course.certificateId %>" class="cta-btn btn-certificate">
      <i class="fas fa-certificate"></i> View Certificate
    </a>
    <button onclick="downloadCertificate('<%= course.certificateId %>')" class="cta-btn btn-secondary">
      <i class="fas fa-download"></i> Download PDF
    </button>
    
  <!-- Certificate Ready to Generate -->
  <% } else if (course.canGetCertificate && !course.hasCertificate) { %>
    <button class="cta-btn btn-generate-certificate" 
            data-course-id="<%= course.courseId %>" 
            data-course-type="<%= course.courseType %>"
            data-course-title="<%= course.title %>">
      <i class="fas fa-trophy"></i> Generate Certificate
    </button>
    
  <!-- Certificate Locked - Show Why -->
  <% } else if (course.courseEnded && course.attendanceConfirmed && course.assessmentRequired && course.assessmentPassed) { %>
    <!-- All requirements met but still locked (shouldn't happen, but safety check) -->
    <div class="cta-btn" style="background: #28a745; color: white;">
      <i class="fas fa-check-circle"></i> Certificate Processing...
    </div>
    
  <!-- Certificate Not Available Yet - Show Status -->
  <% } else { %>
    <!-- Show certificate status and what's needed -->
    <% if (!course.courseEnded) { %>
      <div class="cta-btn certificate-locked" style="background: #f8f9fa; color: #666; cursor: not-allowed; position: relative;">
        <i class="fas fa-lock"></i> 
        Certificate Available After Course Ends
        <div class="tooltip-text">
          Course ends: <%= new Date(course.endDate || course.startDate).toLocaleDateString() %>
        </div>
      </div>
      
    <% } else if (!course.attendanceConfirmed) { %>
      <div class="cta-btn certificate-locked" style="background: #ffc107; color: #333; cursor: not-allowed;">
        <i class="fas fa-user-check"></i> 
        Confirm Attendance First
      </div>
      
    <% } else if (course.assessmentRequired && !course.assessmentPassed) { %>
      <div class="cta-btn certificate-locked" style="background: #dc3545; color: white; cursor: not-allowed;">
        <i class="fas fa-clipboard-question"></i> 
        Pass Assessment Required
      </div>
      
    <% } else if (course.assessmentRequired || course.certificationEnabled) { %>
      <div class="certificate-status-section" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
        <h5 style="color: #333; margin-bottom: 10px;">
          <i class="fas fa-award"></i> Certification Progress
        </h5>
        
        <!-- Progress Checklist -->
        <div style="display: grid; gap: 8px;">
          
          <!-- Course Completion -->
          <div style="display: flex; align-items: center; gap: 10px;">
            <% if (course.courseEnded) { %>
              <i class="fas fa-check-circle" style="color: #28a745;"></i>
              <span style="color: #28a745;">Course Completed</span>
            <% } else if (course.courseInProgress) { %>
              <i class="fas fa-clock" style="color: #ffc107;"></i>
              <span style="color: #ffc107;">Course In Progress</span>
            <% } else { %>
              <i class="fas fa-calendar" style="color: #6c757d;"></i>
              <span style="color: #6c757d;">Course Upcoming</span>
            <% } %>
          </div>
          
          <!-- Attendance -->
          <div style="display: flex; align-items: center; gap: 10px;">
            <% if (course.attendanceConfirmed) { %>
              <i class="fas fa-check-circle" style="color: #28a745;"></i>
              <span style="color: #28a745;">Attendance Confirmed</span>
            <% } else { %>
              <i class="fas fa-times-circle" style="color: #dc3545;"></i>
              <span style="color: #dc3545;">Attendance Pending</span>
            <% } %>
          </div>
          
          <!-- Assessment -->
          <% if (course.assessmentRequired) { %>
            <div style="display: flex; align-items: center; gap: 10px;">
              <% if (course.assessmentPassed) { %>
                <i class="fas fa-check-circle" style="color: #28a745;"></i>
                <span style="color: #28a745;">Assessment Passed (<%= course.assessmentScore %>%)</span>
              <% } else if (course.assessmentCompleted) { %>
                <i class="fas fa-times-circle" style="color: #dc3545;"></i>
                <span style="color: #dc3545;">Assessment Failed (<%= course.assessmentScore %>%)</span>
              <% } else { %>
                <i class="fas fa-minus-circle" style="color: #6c757d;"></i>
                <span style="color: #6c757d;">Assessment Pending</span>
              <% } %>
            </div>
          <% } %>
          
          <!-- Certificate Status -->
          <div style="display: flex; align-items: center; gap: 10px;">
            <% if (course.hasCertificate) { %>
              <i class="fas fa-check-circle" style="color: #28a745;"></i>
              <span style="color: #28a745; font-weight: 600;">Certificate Issued</span>
            <% } else if (course.canGetCertificate) { %>
              <i class="fas fa-trophy" style="color: #ffc107;"></i>
              <span style="color: #ffc107; font-weight: 600;">Certificate Ready</span>
            <% } else { %>
              <i class="fas fa-lock" style="color: #6c757d;"></i>
              <span style="color: #6c757d;">Certificate Locked</span>
            <% } %>
          </div>
        </div>
        
        <!-- Certificate Eligibility Message -->
        <% if (course.certificateEligibilityReason) { %>
          <div style="margin-top: 10px; padding: 8px 12px; background: <%= course.canGetCertificate ? '#d4edda' : '#f8d7da' %>; 
                      border-radius: 6px; font-size: 0.9rem; color: <%= course.canGetCertificate ? '#155724' : '#721c24' %>;">
            <i class="fas fa-info-circle"></i> <%= course.certificateEligibilityReason %>
          </div>
        <% } %>
      </div>
      
    <% } else { %>
      <div class="cta-btn certificate-locked" style="background: #17a2b8; color: white; cursor: not-allowed;">
        <i class="fas fa-hourglass-half"></i> 
        Certificate Processing
      </div>
    <% } %>
  <% } %>

  <!-- ========================================= -->
  <!-- ✅ ASSESSMENT ACTION BUTTONS (FOR TAKING/RETAKING) -->
  <!-- ========================================= -->
  
  <% if (course.assessmentRequired && course.attendanceConfirmed) { %>
    <% if (!course.assessmentCompleted) { %>
      <!-- Take Assessment (First Time) -->
      <a href="/library/in-person/assessment/<%= course.courseId %>" class="cta-btn btn-primary">
        <i class="fas fa-clipboard-check"></i> Take Assessment
      </a>
      
    <% } else if (!course.assessmentPassed && course.canRetake) { %>
      <!-- Retake Assessment -->
      <a href="/library/in-person/assessment/<%= course.courseId %>" class="cta-btn btn-warning">
        <i class="fas fa-redo"></i> Retake Assessment 
        <small>(Attempt <%= (course.currentAttempts || 0) + 1 %> of <%= course.maxAttempts || 3 %>)</small>
      </a>
      
    <% } else if (!course.assessmentPassed && !course.canRetake) { %>
      <!-- No More Attempts -->
      <div class="cta-btn" style="background: #dc3545; color: white; cursor: not-allowed;">
        <i class="fas fa-times-circle"></i> 
        Assessment Failed (No retakes left)
      </div>
      <a href="/contact" class="cta-btn btn-secondary">
        <i class="fas fa-envelope"></i> Contact Support
      </a>
    <% } %>
  <% } %>

  <!-- ========================================= -->
  <!-- ✅ ATTENDANCE ACTION BUTTONS -->
  <!-- ========================================= -->
  
  <% if (!course.attendanceConfirmed) { %>
    <% if (course.canConfirmAttendance) { %>
      <button class="cta-btn btn-confirm-attendance" 
              data-course-id="<%= course.courseId %>" 
              data-course-type="<%= course.courseType %>">
        <i class="fas fa-check"></i> Confirm Attendance
      </button>
    <% } else if (course.courseEnded) { %>
      <div class="cta-btn" style="background: #f8f9fa; color: #666; cursor: not-allowed;">
        <i class="fas fa-exclamation-triangle"></i> 
        Attendance Period Expired
      </div>
      <a href="/contact" class="cta-btn btn-secondary">
        <i class="fas fa-envelope"></i> Contact Support
      </a>
    <% } %>
  <% } %>

  <!-- ========================================= -->
  <!-- ✅ GENERAL COURSE ACTIONS (ALWAYS AVAILABLE) -->
  <!-- ========================================= -->
  
  <!-- Course Details Link -->
  <a href="/in-person/courses/<%= course.courseId %>" class="cta-btn btn-outline-secondary">
    <i class="fas fa-info-circle"></i> Course Details
  </a>

  <!-- Print Details (Optional) -->
  <button onclick="printCourseCard(this.closest('.course-card'))" class="cta-btn btn-outline-secondary">
    <i class="fas fa-print"></i> Print Details
  </button>
</div>
            </div>
          </div>
        <% }) %>
      </div>
      
      <!-- No Results State -->
      <div id="noResults" class="empty-state" style="display: none;">
        <i class="fas fa-search"></i>
        <h3>No courses match your search</h3>
        <p>Try adjusting your filters or search terms.</p>
        <button onclick="clearFilters()" class="cta-btn btn-primary">
          <i class="fas fa-times"></i> Clear Filters
        </button>
      </div>
      
    <% } else { %>
      <div class="empty-state">
        <i class="fas fa-users"></i>
        <h3>No in-person courses in your library yet</h3>
        <p>Register for an in-person training course to see it here.</p>
        <div class="course-actions">
          <a href="/in-person-aesthetic-training" class="cta-btn btn-primary">
            <i class="fas fa-search"></i> Browse In-Person Courses
          </a>
        </div>
      </div>
    <% } %>
  </section>

  <!-- Image Gallery Modal -->
  <div id="galleryModal" class="gallery-modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9);">
    <div class="gallery-content" style="position: relative; margin: auto; padding: 20px; width: 90%; max-width: 1200px; top: 5%;">
      <div class="gallery-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="color: white; margin: 0;">Course Gallery</h2>
        <span class="gallery-close" onclick="closeGallery()" style="color: white; font-size: 2rem; cursor: pointer; font-weight: bold;">&times;</span>
      </div>
      <div id="galleryGrid" class="gallery-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;"></div>
    </div>
  </div>

  <!-- Lightbox for full-size images -->
  <div id="lightbox" class="lightbox" onclick="closeLightbox()" style="display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95);">
    <span class="lightbox-close" style="position: absolute; top: 15px; right: 35px; color: white; font-size: 40px; font-weight: bold; cursor: pointer;">&times;</span>
    <div class="lightbox-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 90%; max-height: 90%;">
      <img id="lightboxImg" src="" alt="Full size image" style="max-width: 100%; max-height: 100%; object-fit: contain;">
    </div>
  </div>

  <!-- Complete JavaScript Functionality -->
  <script>
    // Store gallery images for each course
    const courseGalleries = {};
    <% if (myCourses) { %>
      <% myCourses.forEach(course => { %>
        <% if (course.media?.images?.length > 0) { %>
          courseGalleries['<%= course.courseId %>'] = <%= JSON.stringify(course.media.images) %>;
        <% } %>
      <% }) %>
    <% } %>
    
    // Enhanced Certificate and Attendance Management
    document.addEventListener('DOMContentLoaded', function() {
      initializeFilters();
      initializeCertificateSystem();
      initializeAttendanceSystem();
      initializeProgressiveEnhancements();
    });

    // ========================================
    // FILTER AND SEARCH FUNCTIONALITY
    // ========================================
    
    function initializeFilters() {
      const courseSearch = document.getElementById('courseSearch');
      const statusFilter = document.getElementById('statusFilter');
      const sortBy = document.getElementById('sortBy');
      
      if (courseSearch) courseSearch.addEventListener('input', filterCourses);
      if (statusFilter) statusFilter.addEventListener('change', filterCourses);
      if (sortBy) sortBy.addEventListener('change', sortCourses);
    }
    
    function filterCourses() {
      const searchTerm = document.getElementById('courseSearch')?.value.toLowerCase() || '';
      const statusFilter = document.getElementById('statusFilter')?.value || '';
      const courseCards = document.querySelectorAll('.course-card');
      let visibleCount = 0;
      
      courseCards.forEach(card => {
        const title = card.dataset.title?.toLowerCase() || '';
        const location = card.dataset.location?.toLowerCase() || '';
        const instructor = card.dataset.instructor?.toLowerCase() || '';
        const status = card.dataset.status || '';
        
        const matchesSearch = !searchTerm || 
          title.includes(searchTerm) || 
          location.includes(searchTerm) || 
          instructor.includes(searchTerm);
        
        const matchesStatus = !statusFilter || status === statusFilter;
        
        if (matchesSearch && matchesStatus) {
          card.style.display = 'block';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });
      
      // Show/hide no results message
      const noResults = document.getElementById('noResults');
      if (noResults) {
        if (visibleCount === 0 && courseCards.length > 0) {
          noResults.style.display = 'block';
        } else {
          noResults.style.display = 'none';
        }
      }
    }
    
    function sortCourses() {
      const sortBy = document.getElementById('sortBy')?.value || 'date-desc';
      const courseList = document.getElementById('courseList');
      const courseCards = Array.from(document.querySelectorAll('.course-card'));
      
      if (!courseList) return;
      
      courseCards.sort((a, b) => {
        switch(sortBy) {
          case 'title':
            return (a.dataset.title || '').localeCompare(b.dataset.title || '');
          case 'date-asc':
            return new Date(a.dataset.date || 0) - new Date(b.dataset.date || 0);
          case 'date-desc':
            return new Date(b.dataset.date || 0) - new Date(a.dataset.date || 0);
          case 'status':
            return (a.dataset.status || '').localeCompare(b.dataset.status || '');
          default:
            return new Date(b.dataset.date || 0) - new Date(a.dataset.date || 0);
        }
      });
      
      // Reorder DOM elements
      courseCards.forEach(card => courseList.appendChild(card));
    }
    
    function clearFilters() {
      const courseSearch = document.getElementById('courseSearch');
      const statusFilter = document.getElementById('statusFilter');
      const sortBy = document.getElementById('sortBy');
      
      if (courseSearch) courseSearch.value = '';
      if (statusFilter) statusFilter.value = '';
      if (sortBy) sortBy.value = 'date-desc';
      
      filterCourses();
      sortCourses();
    }

    // ========================================
    // CERTIFICATE SYSTEM WITH LINKED COURSE AWARENESS
    // ========================================
    
    function initializeCertificateSystem() {
      document.querySelectorAll('.btn-generate-certificate').forEach(button => {
        button.addEventListener('click', async function() {
          const courseId = this.dataset.courseId;
          const courseType = this.dataset.courseType;
          const courseTitle = this.dataset.courseTitle;
          
          // Check if this is a linked course
          const courseCard = this.closest('.course-card');
          const linkedCourseInfo = courseCard.querySelector('.linked-course-info');
          const isLinkedCourse = !!linkedCourseInfo;
          
          // Enhanced confirmation dialog for linked courses
          const confirmationHtml = `
            <div style="text-align: center;">
              <i class="fas fa-certificate" style="font-size: 3rem; color: #ffd700; margin-bottom: 15px;"></i>
              <p>Are you ready to generate your certificate for:</p>
              <h4 style="color: #333; margin: 10px 0;">"${courseTitle}"</h4>
              ${isLinkedCourse ? `
                <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin: 15px 0;">
                  <div style="color: #17a2b8; font-weight: 600;">
                    <i class="fas fa-link"></i> <strong>Multi-Component Training Certificate</strong><br>
                    <span style="font-size: 0.9rem; opacity: 0.8;">
                      This certificate recognizes completion of your comprehensive training program.
                    </span>
                  </div>
                </div>
              ` : `
                <p style="color: #666; font-size: 0.9rem;">This will create your official completion certificate.</p>
              `}
              <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0;">
                <div style="color: #155724; font-weight: 600;">
                  <i class="fas fa-check-circle" style="color: #28a745;"></i> All requirements completed<br>
                  <i class="fas fa-award" style="color: #28a745;"></i> Ready for certification
                </div>
              </div>
            </div>
          `;
          
          const result = await Swal.fire({
            title: isLinkedCourse ? 'Generate Comprehensive Certificate' : 'Generate Certificate',
            html: confirmationHtml,
            icon: null,
            showCancelButton: true,
            confirmButtonColor: '#28a745',
            cancelButtonColor: '#6c757d',
            confirmButtonText: '<i class="fas fa-trophy"></i> Yes, Generate Certificate',
            cancelButtonText: 'Cancel'
          });
          
          if (!result.isConfirmed) return;
          
          // Show loading state
          const originalText = this.innerHTML;
          this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating Certificate...';
          this.disabled = true;
          this.classList.add('loading');
          
          try {
            const response = await fetch('/certificates/api/issue', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                courseId: courseId,
                courseType: courseType
              })
            });
            
            const data = await response.json();
            
            if (data.success) {
              // Enhanced success message for linked courses
              const successHtml = `
                <div style="text-align: center;">
                  <i class="fas fa-medal" style="font-size: 4rem; color: #ffd700; margin-bottom: 20px;"></i>
                  <h3 style="color: #28a745;">Congratulations!</h3>
                  <p>Your ${isLinkedCourse ? 'comprehensive training' : ''} certificate has been successfully generated.</p>
                  <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <strong>Certificate ID:</strong> ${data.certificate.certificateId}<br>
                    <strong>Verification Code:</strong> ${data.certificate.verificationCode}
                  </div>
                  <p style="color: #666; font-size: 0.9rem;">You can now view, download, and share your certificate.</p>
                </div>
              `;
              
              await Swal.fire({
                title: 'Certificate Generated! 🎉',
                html: successHtml,
                icon: null,
                confirmButtonColor: '#007bff',
                confirmButtonText: '<i class="fas fa-eye"></i> View Certificate'
              });
              
              // Redirect to certificate view
              window.location.href = `/certificates/view/${data.certificate.certificateId}`;
              
            } else {
              throw new Error(data.message || 'Failed to generate certificate');
            }
            
          } catch (error) {
            console.error('Error generating certificate:', error);
            
            Swal.fire({
              icon: 'error',
              title: 'Certificate Generation Failed',
              text: error.message || 'Failed to generate certificate. Please try again or contact support.',
              confirmButtonColor: '#dc3545'
            });
            
            // Restore button
            this.innerHTML = originalText;
            this.disabled = false;
            this.classList.remove('loading');
          }
        });
      });
    }

    // ========================================
    // ATTENDANCE SYSTEM WITH LINKED COURSE CONTEXT
    // ========================================
    
    function initializeAttendanceSystem() {
      document.querySelectorAll('.btn-confirm-attendance').forEach(button => {
        button.addEventListener('click', async function() {
          const courseId = this.dataset.courseId;
          const courseType = this.dataset.courseType;
          const courseTitle = this.closest('.course-card').querySelector('.course-title').textContent;
          
          // Check if this is a linked course
          const courseCard = this.closest('.course-card');
          const linkedCourseInfo = courseCard.querySelector('.linked-course-info');
          const isLinkedCourse = !!linkedCourseInfo;
          
          // Enhanced confirmation dialog for linked courses
          const confirmationHtml = `
            <div style="text-align: center;">
              <i class="fas fa-user-check" style="font-size: 3rem; color: #28a745; margin-bottom: 15px;"></i>
              <p>Please confirm that you attended:</p>
              <h4 style="color: #333; margin: 10px 0;">"${courseTitle}"</h4>
              ${isLinkedCourse ? `
                <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin: 15px 0;">
                  <div style="color: #17a2b8; font-weight: 600;">
                    <i class="fas fa-link"></i> <strong>Part of Multi-Component Training</strong><br>
                    <span style="font-size: 0.9rem; opacity: 0.8;">
                      This course is part of your comprehensive training program.
                    </span>
                  </div>
                </div>
              ` : ''}
              <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; color: #856404;">
                <i class="fas fa-info-circle"></i> 
                <strong>Important:</strong> Only confirm if you actually attended this course.
              </div>
            </div>
          `;
          
          const result = await Swal.fire({
            title: 'Confirm Attendance',
            html: confirmationHtml,
            icon: null,
            showCancelButton: true,
            confirmButtonColor: '#28a745',
            cancelButtonColor: '#6c757d',
            confirmButtonText: '<i class="fas fa-check"></i> Yes, I Attended',
            cancelButtonText: 'Cancel'
          });
          
          if (!result.isConfirmed) return;
          
          // Show loading state
          const originalText = this.innerHTML;
          this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Confirming...';
          this.disabled = true;
          this.classList.add('loading');
          
          try {
            const response = await fetch(`/library/confirm-attendance/${courseId}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                courseType: courseType
              })
            });
            
            const data = await response.json();
            
            if (data.success) {
              // Enhanced success message with linked course context
              let successMessage = data.message;
              
              if (data.linkedCourseInfo && data.linkedCourseInfo.isLinked) {
                successMessage += `\n\n${data.linkedCourseInfo.message}`;
              }
              
              await Swal.fire({
                icon: 'success',
                title: 'Attendance Confirmed! ✅',
                text: successMessage,
                confirmButtonColor: '#28a745'
              });
              
              // Reload page to show updated state
              window.location.reload();
              
            } else {
              throw new Error(data.message);
            }
            
          } catch (error) {
            console.error('Error confirming attendance:', error);
            
            Swal.fire({
              icon: 'error',
              title: 'Confirmation Failed',
              text: error.message || 'Failed to confirm attendance. Please try again.',
              confirmButtonColor: '#dc3545'
            });
            
            // Restore button
            this.innerHTML = originalText;
            this.disabled = false;
            this.classList.remove('loading');
          }
        });
      });
    }

    // ========================================
    // CERTIFICATE ACTIONS (Download & Share)
    // ========================================
    
    window.downloadCertificate = async function(certificateId) {
      try {
        const response = await fetch(`/certificates/download/${certificateId}`);
        const data = await response.json();
        
        if (data.success) {
          if (data.downloadUrl) {
            const link = document.createElement('a');
            link.href = data.downloadUrl;
            link.download = `certificate-${certificateId}.pdf`;
            link.click();
            
            // Show success toast
            Swal.fire({
              icon: 'success',
              title: 'Download Started! 📥',
              text: 'Your certificate is downloading...',
              timer: 2000,
              timerProgressBar: true,
              showConfirmButton: false,
              toast: true,
              position: 'top-end'
            });
          } else {
            Swal.fire({
              icon: 'info',
              title: 'PDF Generation Coming Soon',
              text: 'PDF download functionality will be available soon. You can currently share your certificate verification link.',
              confirmButtonColor: '#17a2b8'
            });
          }
        }
      } catch (error) {
        console.error('Download error:', error);
        Swal.fire({
          icon: 'error',
          title: 'Download Failed',
          text: 'Failed to download certificate. Please try again.',
          confirmButtonColor: '#dc3545'
        });
      }
    };

    window.shareCertificate = async function(certificateId, courseTitle) {
      Swal.fire({
        title: 'Share Your Achievement! 🎉',
        html: `
          <div style="text-align: center; margin: 20px 0;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
              <i class="fas fa-medal" style="font-size: 2rem; margin-bottom: 10px;"></i>
              <h4 style="margin: 10px 0;">Certificate of Completion</h4>
              <p style="margin: 5px 0; opacity: 0.9;">${courseTitle}</p>
              <p style="margin: 0; font-size: 0.9rem; opacity: 0.8;">IAAI Training Institute</p>
            </div>
            
            <p style="margin-bottom: 20px; color: #666;">Share your professional achievement:</p>
            
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
              <button onclick="shareOnLinkedIn('${certificateId}', '${courseTitle}')" class="swal-btn swal-btn-linkedin">
                <i class="fab fa-linkedin"></i> LinkedIn
              </button>
              <button onclick="shareOnTwitter('${certificateId}', '${courseTitle}')" class="swal-btn swal-btn-twitter">
                <i class="fab fa-twitter"></i> Twitter
              </button>
              <button onclick="copyVerificationLink('${certificateId}')" class="swal-btn swal-btn-primary">
                <i class="fas fa-copy"></i> Copy Link
              </button>
            </div>
          </div>
        `,
        showConfirmButton: false,
        showCloseButton: true,
        customClass: {
          popup: 'share-modal'
        },
        didOpen: () => {
          const style = document.createElement('style');
          style.textContent = `
            .share-modal { width: 90% !important; max-width: 500px !important; }
            .swal-btn {
              padding: 8px 16px; border: none; border-radius: 6px; color: white;
              font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 0.9rem;
            }
            .swal-btn-primary { background: #3182ce; }
            .swal-btn-linkedin { background: #0077b5; }
            .swal-btn-twitter { background: #1da1f2; }
            .swal-btn:hover { transform: translateY(-1px); opacity: 0.9; }
          `;
          document.head.appendChild(style);
        }
      });
    };

    // Share functions
    window.shareOnLinkedIn = function(certificateId, courseTitle) {
      const text = `I just completed "${courseTitle}" and earned my certificate from IAAI Training Institute! 🎓`;
      const url = encodeURIComponent(`${window.location.origin}/certificates/view/${certificateId}`);
      const linkedinUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${url}&summary=${encodeURIComponent(text)}`;
      window.open(linkedinUrl, '_blank', 'width=600,height=500');
    };

    window.shareOnTwitter = function(certificateId, courseTitle) {
      const text = `Just earned my certificate in "${courseTitle}" from @IAAI_Training! 🎓 #ProfessionalDevelopment #AestheticTraining`;
      const url = encodeURIComponent(`${window.location.origin}/certificates/view/${certificateId}`);
      const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${url}`;
      window.open(twitterUrl, '_blank', 'width=600,height=400');
    };

    window.copyVerificationLink = function(certificateId) {
      const url = `${window.location.origin}/certificates/view/${certificateId}`;
      navigator.clipboard.writeText(url).then(() => {
        Swal.fire({
          icon: 'success',
          title: 'Copied! 📋',
          text: 'Certificate link copied to clipboard',
          timer: 2000,
          timerProgressBar: true,
          showConfirmButton: false,
          toast: true,
          position: 'top-end'
        });
      });
    };

    // ========================================
    // GALLERY FUNCTIONALITY
    // ========================================
    
    function showImageGallery(courseId) {
      const modal = document.getElementById('galleryModal');
      const grid = document.getElementById('galleryGrid');
      const images = courseGalleries[courseId] || [];
      
      if (!modal || !grid) return;
      
      // Clear previous content
      grid.innerHTML = '';
      
      if (images.length === 0) {
        grid.innerHTML = '<p style="color: white; text-align: center; grid-column: 1/-1;">No images available for this course.</p>';
        modal.style.display = 'block';
        return;
      }
      
      // Add images to grid
      images.forEach((imageUrl, index) => {
        const item = document.createElement('div');
        item.className = 'gallery-item';
        item.style.cssText = 'cursor: pointer; position: relative; overflow: hidden; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);';
        item.innerHTML = `
          <img src="${imageUrl}" 
               alt="Course image ${index + 1}" 
               onclick="openLightbox('${imageUrl}')" 
               style="width: 100%; height: 200px; object-fit: cover; transition: transform 0.3s ease;" 
               onmouseover="this.style.transform='scale(1.05)'" 
               onmouseout="this.style.transform='scale(1)'"
               onerror="this.parentElement.style.display='none'">
          <div style="position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.8rem;">
            ${index + 1}/${images.length}
          </div>
        `;
        grid.appendChild(item);
      });
      
      modal.style.display = 'block';
    }
    
    function closeGallery() {
      const modal = document.getElementById('galleryModal');
      if (modal) modal.style.display = 'none';
    }
    
    function openLightbox(imageUrl) {
      const lightbox = document.getElementById('lightbox');
      const img = document.getElementById('lightboxImg');
      if (lightbox && img) {
        img.src = imageUrl;
        lightbox.style.display = 'block';
        
        // Add keyboard navigation for lightbox
        const handleKeyPress = (e) => {
          if (e.key === 'Escape') {
            closeLightbox();
            document.removeEventListener('keydown', handleKeyPress);
          }
        };
        document.addEventListener('keydown', handleKeyPress);
      }
    }
    
    function closeLightbox() {
      const lightbox = document.getElementById('lightbox');
      if (lightbox) lightbox.style.display = 'none';
    }

    // ========================================
    // MATERIALS TOGGLE AND INTERACTION
    // ========================================
    
    function toggleMaterials(courseId) {
      const courseCard = document.querySelector(`[data-course-id="${courseId}"]`)?.closest('.course-card');
      if (!courseCard) return;
      
      const materialsSection = courseCard.querySelector('.video-section');
      const toggleButton = courseCard.querySelector('button[onclick*="toggleMaterials"]');
      
      if (materialsSection) {
        if (materialsSection.style.display === 'none') {
          materialsSection.style.display = 'block';
          materialsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          if (toggleButton) {
            toggleButton.innerHTML = '<i class="fas fa-folder"></i> Hide Materials';
          }
        } else {
          materialsSection.style.display = 'none';
          if (toggleButton) {
            toggleButton.innerHTML = '<i class="fas fa-folder-open"></i> Show Materials';
          }
        }
      }
    }

    // ========================================
    // ENHANCED USER INTERACTIONS
    // ========================================
    
    // Initialize material toggle buttons
    function initializeMaterialToggles() {
      document.querySelectorAll('button[onclick*="toggleMaterials"]').forEach(button => {
        const originalText = button.innerHTML;
        button.setAttribute('data-original-text', originalText);
      });
    }

    // Add hover effects to course cards
    function initializeCardInteractions() {
      document.querySelectorAll('.course-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-4px) scale(1.01)';
        });
        
        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0) scale(1)';
        });
      });
    }

    // Initialize print functionality
    function initializePrintSupport() {
      // Add print button to course cards
      document.querySelectorAll('.course-card').forEach(card => {
        const courseActions = card.querySelector('.course-actions');
        if (courseActions && !card.querySelector('.btn-print')) {
          const printButton = document.createElement('button');
          printButton.className = 'cta-btn btn-outline-secondary btn-print';
          printButton.innerHTML = '<i class="fas fa-print"></i> Print Details';
          printButton.onclick = () => printCourseCard(card);
          courseActions.appendChild(printButton);
        }
      });
    }

    function printCourseCard(card) {
      const courseTitle = card.querySelector('.course-title').textContent;
      const courseContent = card.cloneNode(true);
      
      // Remove interactive elements
      courseContent.querySelectorAll('.course-actions, .video-actions, button').forEach(el => el.remove());
      
      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Course Details - ${courseTitle}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            .course-card { box-shadow: none; border: 1px solid #ddd; }
            .course-header { background: #f8f9fa !important; color: #333 !important; }
            @media print {
              body { margin: 0; }
              .course-card { border: none; box-shadow: none; }
            }
          </style>
        </head>
        <body>
          <h1>Course Details</h1>
          ${courseContent.outerHTML}
          <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; font-size: 0.9rem;">
            Generated on: ${new Date().toLocaleDateString()} | IAAI Training Institute
          </div>
        </body>
        </html>
      `);
      printWindow.document.close();
      printWindow.print();
    }

    // ========================================
    // ACCESSIBILITY ENHANCEMENTS
    // ========================================
    
    function initializeAccessibility() {
      // Add ARIA labels to interactive elements
      document.querySelectorAll('.cta-btn').forEach(button => {
        if (!button.getAttribute('aria-label')) {
          const text = button.textContent.trim();
          button.setAttribute('aria-label', text);
        }
      });
      
      // Add keyboard navigation to course cards
      document.querySelectorAll('.course-card').forEach((card, index) => {
        card.setAttribute('tabindex', '0');
        card.setAttribute('role', 'article');
        card.setAttribute('aria-label', `Course: ${card.querySelector('.course-title').textContent}`);
        
        card.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            const detailsLink = this.querySelector('a[href*="/courses/"]');
            if (detailsLink) detailsLink.click();
          }
        });
      });
      
      // Enhance modal accessibility
      const modals = ['galleryModal', 'lightbox'];
      modals.forEach(modalId => {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.setAttribute('role', 'dialog');
          modal.setAttribute('aria-modal', 'true');
        }
      });
    }

    // ========================================
    // PERFORMANCE OPTIMIZATIONS
    // ========================================
    
    function initializePerformanceOptimizations() {
      // Lazy load images in gallery
      if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              img.src = img.dataset.src;
              img.classList.remove('lazy');
              observer.unobserve(img);
            }
          });
        });
        
        document.querySelectorAll('img[data-src]').forEach(img => {
          imageObserver.observe(img);
        });
      }
      
      // Debounce search input
      let searchTimeout;
      const searchInput = document.getElementById('courseSearch');
      if (searchInput) {
        searchInput.removeEventListener('input', filterCourses);
        searchInput.addEventListener('input', function() {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(filterCourses, 300);
        });
      }
    }

    // ========================================
    // UTILITY FUNCTIONS
    // ========================================
    
    // Close modals when clicking outside
    window.onclick = function(event) {
      const galleryModal = document.getElementById('galleryModal');
      const lightbox = document.getElementById('lightbox');
      
      if (event.target == galleryModal) {
        closeGallery();
      }
      if (event.target == lightbox) {
        closeLightbox();
      }
    }

    // Enhanced keyboard navigation
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeGallery();
        closeLightbox();
      }
      
      // Add Ctrl+F for search focus
      if (e.ctrlKey && e.key === 'f') {
        e.preventDefault();
        const searchInput = document.getElementById('courseSearch');
        if (searchInput) {
          searchInput.focus();
          searchInput.select();
        }
      }
    });

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // ========================================
    // PROGRESSIVE ENHANCEMENT
    // ========================================
    
    function initializeProgressiveEnhancements() {
      // Check for modern browser features
      const hasModernFeatures = 'fetch' in window && 'Promise' in window;
      
      if (!hasModernFeatures) {
        // Fallback for older browsers
        document.querySelectorAll('.btn-generate-certificate, .btn-confirm-attendance').forEach(button => {
          button.onclick = function() {
            alert('This feature requires a modern browser. Please update your browser and try again.');
          };
        });
        return;
      }

      // Initialize all modern features
      initializeMaterialToggles();
      initializeCardInteractions();
      initializePrintSupport();
      initializeAccessibility();
      initializePerformanceOptimizations();
      
      // Add connection status indicator
      if ('navigator' in window && 'onLine' in navigator) {
        const connectionStatus = document.createElement('div');
        connectionStatus.id = 'connectionStatus';
        connectionStatus.style.cssText = `
          position: fixed; top: 0; left: 0; right: 0; z-index: 9999;
          background: #dc3545; color: white; text-align: center; padding: 5px;
          transform: translateY(-100%); transition: transform 0.3s ease;
        `;
        connectionStatus.innerHTML = '<i class="fas fa-wifi"></i> No internet connection';
        document.body.appendChild(connectionStatus);
        
        function updateConnectionStatus() {
          if (navigator.onLine) {
            connectionStatus.style.transform = 'translateY(-100%)';
          } else {
            connectionStatus.style.transform = 'translateY(0)';
          }
        }
        
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);
      }
    }

    // Add custom CSS for enhanced interactions
    const enhancedStyles = document.createElement('style');
    enhancedStyles.textContent = `
      /* Enhanced filtering styles */
      .course-card.hidden {
        display: none !important;
      }
      
      .course-card {
        transition: all 0.3s ease;
      }
      
      /* Gallery enhancements */
      .gallery-item {
        position: relative;
        overflow: hidden;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        cursor: pointer;
      }
      
      .gallery-item img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        transition: transform 0.3s ease;
      }
      
      .gallery-item:hover img {
        transform: scale(1.05);
      }
      
      /* Loading states */
      .loading {
        position: relative;
        pointer-events: none;
        opacity: 0.7;
      }
      
      .loading::after {
        content: '';
        position: absolute;
        width: 16px;
        height: 16px;
        margin: auto;
        border: 2px solid transparent;
        border-top-color: currentColor;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
      
      @keyframes spin {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
      }
      
      /* Print optimizations */
      @media print {
        .course-actions,
        .video-actions,
        .gallery-modal,
        .lightbox,
        #connectionStatus,
        .btn-print {
          display: none !important;
        }
        
        .course-card {
          break-inside: avoid;
          box-shadow: none;
          border: 1px solid #000;
          margin-bottom: 20px;
        }
        
        .course-header {
          background: #f8f9fa !important;
          color: #000 !important;
        }
        
        .linked-course-info {
          border: 2px solid #17a2b8 !important;
          animation: none !important;
        }
      }
      
      /* Focus styles for accessibility */
      .course-card:focus {
        outline: 3px solid #007bff;
        outline-offset: 2px;
      }
      
      .cta-btn:focus,
      .video-action:focus {
        outline: 3px solid var(--secondary-color);
        outline-offset: 2px;
      }
      
      /* Dark mode support */
      @media (prefers-color-scheme: dark) {
        .gallery-modal {
          background: rgba(0,0,0,0.95);
        }
        
        .lightbox {
          background: rgba(0,0,0,0.98);
        }
      }
      
      /* Reduced motion support */
      @media (prefers-reduced-motion: reduce) {
        .course-card,
        .gallery-item img,
        .cta-btn,
        .loading::after {
          transition: none !important;
          animation: none !important;
        }
        
        .course-card:hover {
          transform: none !important;
        }
      }
      
      /* High contrast mode */
      @media (prefers-contrast: high) {
        .course-card {
          border: 2px solid #000;
        }
        
        .cta-btn {
          border: 2px solid currentColor;
        }
        
        .linked-course-badge,
        .course-status {
          border: 2px solid #fff;
        }
      }
    `;
    document.head.appendChild(enhancedStyles);
  </script>


  <%- include('partials/footer') %>
</body>
</html>