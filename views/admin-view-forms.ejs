<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>International Aesthetic Academic Institution (IAAI)</title>
        <link rel="stylesheet" href="/css/admin.css"> <!-- Link to the main CSS -->
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"> <!-- Google Fonts -->
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <script src="https://kit.fontawesome.com/a076d05399.js"></script> <!-- FontAwesome for icons -->
      </head>
      
      <%- include('partials/header') %>
      

       <!-- ✅ Admin Header -->
    <header>
        <h1>Admin Dashboard - View Applications</h1>
        <a href="/dashboard" class="cta-btn">Admin Home</a>
    </header>

    <section class="admin-container">
        <h2>All Submitted Applications</h2>

        <% if (applications.length > 0) { %>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Application Type</th>
                        <th>Details</th>
                        <th>Submitted At</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% applications.forEach(application => { %>
                        <tr>
                            <td><%= application.fullName || application.name %></td>
                            <td><%= application.email %></td>
                            <td><%= application.phoneNumber || 'N/A' %></td>
                            <td><%= application.applicationType %></td>
                            <td>
                                <% if (application.applicationType === 'Trainer Application') { %>
                                    <strong>Experience:</strong> <%= application.experience %> years <br>
                                    <strong>Expertise:</strong> <%= application.expertise %> <br>
                                    <strong>CV:</strong> <a href="<%= application.cvUrl %>" target="_blank">View CV</a> <br>
                                    <strong>Status:</strong> <%= application.status %>
                                <% } else if (application.applicationType === 'In-Company Training') { %>
                                    <strong>Company:</strong> <%= application.companyName || 'N/A' %> <br>
                                    <strong>Message:</strong> <%= application.message %>
                                <% } else if (application.applicationType === 'On-Demand Course') { %>
                                    <strong>Course Interest:</strong> <%= application.courseInterest %>
                                <% } else if (application.applicationType === 'Contact Us') { %>
                                    <strong>Subject:</strong> <%= application.subject %> <br>
                                    <strong>Message:</strong> <%= application.message %>
                                <% } %>
                            </td>
                            <td><%= new Date(application.submittedAt || application.appliedAt || application.date).toLocaleDateString() %></td>
                            <td>
                                <button class="delete-btn" data-application-id="<%= application._id %>">Delete</button>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        <% } else { %>
            <p>No applications found.</p>
        <% } %>
    </section>
    <%- include('partials/footer') %>


    <!-- ✅ JavaScript for Deleting Applications -->
    <script>
        document.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', async (e) => {
                const applicationId = e.target.getAttribute('data-application-id');

                if (confirm('Are you sure you want to delete this application?')) {
                    try {
                        const response = await fetch('/admin/delete-application', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ applicationId })
                        });

                        const result = await response.json();
                        alert(result.message);
                        if (result.success) {
                            location.reload();
                        }
                    } catch (err) {
                        console.error('❌ Error:', err);
                        alert('Error deleting application.');
                    }
                }
            });
        });
    </script>

</body>
</html>