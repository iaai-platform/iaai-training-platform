<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>In-Person Aesthetic Training Courses - IAAI</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Add your existing styles here - will provide in next message */
  </style>
</head>

<body>
  <%- include('partials/header') %>

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="hero-content">
      <div class="hero-text">
        <h1 class="hero-title">In-Person Aesthetic Training Courses</h1>
        <p class="hero-description">
          Master advanced aesthetic techniques with hands-on training from world-renowned experts. 
          Join medical professionals worldwide in our comprehensive certification programs.
        </p>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <div class="main-content">
    <div class="container">
      
      <!-- Registration Instructions -->
      <div class="registration-instructions">
        <div class="instruction-card">
          <div class="instruction-icon">
            <i class="fas fa-info-circle"></i>
          </div>
          <div class="instruction-content">
            <h3>How to Register</h3>
            <p>
              <strong>Quick Registration:</strong> Click 
              <span class="instruction-highlight">"Add to Cart"</span> to enroll immediately (you'll be redirected to checkout), or 
              <span class="instruction-highlight">"Add to Wishlist"</span> to save for later. 
              <span class="instruction-highlight">"View Details"</span> shows complete course information.
            </p>
          </div>
        </div>
      </div>

      <!-- Available Courses Section -->
      <section class="courses-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-calendar-alt"></i>
            Available Courses
          </h2>
          <p class="section-subtitle">Upcoming in-person training opportunities</p>
        </div>

        <!-- Available Courses Table -->
        <div class="courses-table-container">
          <% if (courses && courses.filter(course => !course.isExpired && course.status !== 'completed').length > 0) { %>
            <div class="table-responsive">
              <table class="courses-table" id="availableCoursesTable">
                <thead>
                  <tr>
                    <th class="course-info-col">Course Information</th>
                    <th class="schedule-col">Schedule</th>
                    <th class="location-col">Location</th>
                    <th class="instructor-col">Instructor</th>
                    <th class="price-col">Price</th>
                    <th class="status-col">Status</th>
                    <th class="action-col">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% courses.filter(course => !course.isExpired && course.status !== 'completed').forEach(course => { %>
                    <tr class="course-row" data-course-id="<%= course._id %>" data-status="<%= course.status %>">
                      <!-- Course Information -->
                      <td class="course-info">
                        <div class="course-title">
                          <h4><%= course.title %></h4>
                          <span class="course-code"><%= course.courseCode %></span>
                        </div>
                        <div class="course-description">
                          <%= course.basic?.description ? course.basic.description.substring(0, 100) + '...' : 'Comprehensive aesthetic training program' %>
                        </div>
                      </td>

                      <!-- Schedule -->
                      <td class="schedule">
                        <div class="schedule-info">
                          <div class="start-date">
                            <i class="fas fa-calendar"></i>
                            <%= course.startDate ? new Date(course.startDate).toLocaleDateString('en-US', { 
                              month: 'short', 
                              day: 'numeric', 
                              year: 'numeric' 
                            }) : 'TBA' %>
                          </div>
                          <% if (course.endDate && course.startDate !== course.endDate) { %>
                            <div class="end-date">
                              to <%= new Date(course.endDate).toLocaleDateString('en-US', { 
                                month: 'short', 
                                day: 'numeric' 
                              }) %>
                            </div>
                          <% } %>
                          <div class="duration">
                            <i class="fas fa-clock"></i>
                            <%= course.duration %>
                          </div>
                        </div>
                      </td>

                      <!-- Location -->
                      <td class="location">
                        <div class="location-info">
                          <div class="venue-name">
                            <i class="fas fa-map-marker-alt"></i>
                            <%= course.venue?.name || course.location %>
                          </div>
                          <div class="city-country">
                            <%= course.city %>, <%= course.country %>
                          </div>
                        </div>
                      </td>

                      <!-- Instructor -->
                      <td class="instructor">
                        <div class="instructor-info">
                          <i class="fas fa-user-md"></i>
                          <%= course.instructorNames || course.instructor %>
                        </div>
                      </td>

                      <!-- Price -->
                      <td class="price">
                        <div class="price-info">
                          <% if (course.earlyBirdPrice && course.isEarlyBirdActive) { %>
                            <div class="early-bird-price">
                              <%= getCurrencySymbol(course.currency) %><%= course.earlyBirdPrice %>
                              <span class="early-bird-label">Early Bird</span>
                            </div>
                            <div class="regular-price">
                              <del><%= getCurrencySymbol(course.currency) %><%= course.price %></del>
                            </div>
                          <% } else { %>
                            <div class="current-price">
                              <%= getCurrencySymbol(course.currency) %><%= course.price %>
                            </div>
                          <% } %>
                        </div>
                      </td>

                      <!-- Status -->
                      <td class="status">
                        <span class="status-badge status-<%= course.status %>">
                          <% if (course.status === 'open') { %>
                            <i class="fas fa-check-circle"></i> Open
                          <% } else if (course.status === 'full') { %>
                            <i class="fas fa-users"></i> Full
                          <% } else if (course.status === 'in-progress') { %>
                            <i class="fas fa-play-circle"></i> In Progress
                          <% } else { %>
                            <i class="fas fa-info-circle"></i> <%= course.status.charAt(0).toUpperCase() + course.status.slice(1) %>
                          <% } %>
                        </span>
                        <% if (course.availableSeats !== undefined) { %>
                          <div class="seats-info">
                            <%= course.availableSeats %> of <%= course.maxEnrollment %> seats
                          </div>
                        <% } %>
                      </td>

                      <!-- Actions -->
                      <td class="actions">
                        <div class="action-buttons">
                          <!-- View Details Button -->
                          <a href="/in-person/courses/<%= course._id %>" class="btn btn-sm btn-outline">
                            <i class="fas fa-eye"></i> Details
                          </a>

                          <% if (user) { %>
                            <!-- Add to Cart Button -->
                            <% if (course.status === 'open' && course.availableSeats > 0) { %>
                              <button class="btn btn-sm btn-primary add-to-cart-btn" 
                                      data-course-id="<%= course._id %>" 
                                      data-course-type="InPersonAestheticTraining"
                                      data-price="<%= course.earlyBirdPrice && course.isEarlyBirdActive ? course.earlyBirdPrice : course.price %>"
                                      data-course-code="<%= course.courseCode %>"
                                      data-course-title="<%= course.title %>">
                                <i class="fas fa-shopping-cart"></i> Add to Cart
                              </button>
                            <% } else { %>
                              <button class="btn btn-sm btn-disabled" disabled>
                                <i class="fas fa-ban"></i> 
                                <%= course.status === 'full' ? 'Full' : 'Unavailable' %>
                              </button>
                            <% } %>

                            <!-- Add to Wishlist Button -->
                            <button class="btn btn-sm btn-secondary add-to-wishlist-btn" 
                                    data-course-id="<%= course._id %>" 
                                    data-course-type="InPersonAestheticTraining"
                                    data-price="<%= course.earlyBirdPrice && course.isEarlyBirdActive ? course.earlyBirdPrice : course.price %>"
                                    data-course-code="<%= course.courseCode %>"
                                    data-course-title="<%= course.title %>">
                              <i class="fas fa-heart"></i> Wishlist
                            </button>
                          <% } else { %>
                            <!-- Login Required Buttons -->
                            <button class="btn btn-sm btn-primary" onclick="showLoginRequired()">
                              <i class="fas fa-shopping-cart"></i> Add to Cart
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="showLoginRequired()">
                              <i class="fas fa-heart"></i> Wishlist
                            </button>
                          <% } %>
                        </div>
                      </td>
                    </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>
          <% } else { %>
            <div class="no-courses">
              <div class="no-courses-icon">
                <i class="fas fa-calendar-times"></i>
              </div>
              <h3>No Available Courses</h3>
              <p>There are currently no upcoming in-person courses available. Please check back soon or contact us for more information.</p>
              <a href="/contact" class="btn btn-primary">
                <i class="fas fa-envelope"></i> Contact Us
              </a>
            </div>
          <% } %>
        </div>
      </section>

      <!-- Course History Section -->
      <section class="history-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-history"></i>
            Course History & Experience
          </h2>
          <p class="section-subtitle">Previously conducted training programs demonstrating our expertise and global reach</p>
        </div>

        <!-- Historical Courses Table -->
        <div class="courses-table-container">
          <% 
            const completedCourses = courses ? courses.filter(course => 
              course.isExpired || course.status === 'completed'
            ) : [];
          %>
          
          <% if (completedCourses.length > 0) { %>
            <div class="table-responsive">
              <table class="courses-table history-table" id="historicalCoursesTable">
                <thead>
                  <tr>
                    <th class="course-info-col">Course Information</th>
                    <th class="schedule-col">Date Conducted</th>
                    <th class="location-col">Location</th>
                    <th class="instructor-col">Instructor</th>
                    <th class="participants-col">Participants</th>
                    <th class="completion-col">Completion</th>
                  </tr>
                </thead>
                <tbody>
                  <% completedCourses.forEach(course => { %>
                    <tr class="course-row completed-course">
                      <!-- Course Information -->
                      <td class="course-info">
                        <div class="course-title">
                          <h4><%= course.title %></h4>
                          <span class="course-code"><%= course.courseCode %></span>
                        </div>
                        <div class="course-description">
                          <%= course.basic?.description ? course.basic.description.substring(0, 80) + '...' : 'Professional aesthetic training' %>
                        </div>
                      </td>

                      <!-- Date Conducted -->
                      <td class="schedule">
                        <div class="schedule-info">
                          <div class="start-date">
                            <i class="fas fa-calendar-check"></i>
                            <%= course.startDate ? new Date(course.startDate).toLocaleDateString('en-US', { 
                              month: 'short', 
                              day: 'numeric', 
                              year: 'numeric' 
                            }) : 'N/A' %>
                          </div>
                          <% if (course.endDate && course.startDate !== course.endDate) { %>
                            <div class="end-date">
                              to <%= new Date(course.endDate).toLocaleDateString('en-US', { 
                                month: 'short', 
                                day: 'numeric' 
                              }) %>
                            </div>
                          <% } %>
                          <div class="duration">
                            <i class="fas fa-clock"></i>
                            <%= course.duration %>
                          </div>
                        </div>
                      </td>

                      <!-- Location -->
                      <td class="location">
                        <div class="location-info">
                          <div class="venue-name">
                            <i class="fas fa-map-marker-alt"></i>
                            <%= course.venue?.name || course.location %>
                          </div>
                          <div class="city-country">
                            <%= course.city %>, <%= course.country %>
                          </div>
                        </div>
                      </td>

                      <!-- Instructor -->
                      <td class="instructor">
                        <div class="instructor-info">
                          <i class="fas fa-user-md"></i>
                          <%= course.instructorNames || course.instructor %>
                        </div>
                      </td>

                      <!-- Participants -->
                      <td class="participants">
                        <div class="participants-info">
                          <div class="participant-count">
                            <i class="fas fa-users"></i>
                            <%= course.currentEnrollment || 0 %> participants
                          </div>
                          <div class="capacity">
                            Capacity: <%= course.maxEnrollment || course.seatsAvailable || 'N/A' %>
                          </div>
                        </div>
                      </td>

                      <!-- Completion Status -->
                      <td class="completion">
                        <span class="status-badge status-completed">
                          <i class="fas fa-check-double"></i> Completed
                        </span>
                        <div class="completion-info">
                          Successfully conducted
                        </div>
                      </td>
                    </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>

            <!-- History Summary -->
            <div class="history-summary">
              <div class="summary-stats">
                <div class="stat-item">
                  <div class="stat-number"><%= completedCourses.length %></div>
                  <div class="stat-label">Courses Completed</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number">
                    <%= completedCourses.reduce((total, course) => total + (course.currentEnrollment || 0), 0) %>
                  </div>
                  <div class="stat-label">Professionals Trained</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number">
                    <%= [...new Set(completedCourses.map(course => `${course.city}, ${course.country}`))].length %>
                  </div>
                  <div class="stat-label">Training Locations</div>
                </div>
              </div>
            </div>
          <% } else { %>
            <div class="no-courses">
              <div class="no-courses-icon">
                <i class="fas fa-history"></i>
              </div>
              <h3>No Historical Data Available</h3>
              <p>Course history will appear here as we complete training programs.</p>
            </div>
          <% } %>
        </div>
      </section>

      <!-- Call to Action Section -->
      <section class="cta-section">
        <div class="cta-content">
          <h2>Ready to Advance Your Medical Career?</h2>
          <p>Join thousands of medical professionals who have transformed their practice with our world-class aesthetic training programs.</p>
          <div class="cta-buttons">
            <a href="/contact" class="btn btn-primary btn-lg">
              <i class="fas fa-phone"></i> Contact Us
            </a>
            <a href="/online-live-training" class="btn btn-secondary btn-lg">
              <i class="fas fa-laptop"></i> Online Courses
            </a>
          </div>
        </div>
      </section>

    </div>
  </div>

  <!-- Notification Container -->
  <div id="notificationContainer"></div>

  <!-- JavaScript -->
  <script>
    // Enhanced Notification System
    function showNotification(title, message, type = 'success') {
      const container = document.getElementById('notificationContainer');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      
      const iconMap = {
        success: 'fa-check-circle',
        error: 'fa-times-circle',
        warning: 'fa-exclamation-triangle'
      };
      
      notification.innerHTML = `
        <div class="notification-icon">
          <i class="fas ${iconMap[type]}"></i>
        </div>
        <div class="notification-content">
          <h4>${title}</h4>
          <p>${message}</p>
        </div>
      `;
      
      container.appendChild(notification);
      
      // Show notification with animation
      setTimeout(() => notification.classList.add('show'), 10);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 500);
      }, 5000);
    }

    // Show login required message
    function showLoginRequired() {
      showNotification('Authentication Required', 'Please log in to continue with enrollment', 'warning');
      setTimeout(() => {
        window.location.href = '/login';
      }, 2000);
    }

    // Add to Cart functionality
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
      button.addEventListener('click', async (e) => {
        const button = e.currentTarget;
        
        if (button.disabled) return;
        
        const courseData = {
          courseId: button.getAttribute('data-course-id'),
          courseType: button.getAttribute('data-course-type'),
          price: button.getAttribute('data-price'),
          courseCode: button.getAttribute('data-course-code')
        };
        const courseTitle = button.getAttribute('data-course-title');

        // Set loading state
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';

        try {
          const response = await fetch('/add-to-cart', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(courseData)
          });

          const result = await response.json();
          
          if (result.success) {
            showNotification('Successfully Added!', `"${courseTitle}" has been added to your cart`, 'success');
            
            // Redirect to orders page after 2 seconds
            setTimeout(() => {
              window.location.href = '/orders';
            }, 2000);
          } else {
            showNotification('Unable to Add', result.message || 'Please try again', 'warning');
            button.disabled = false;
            button.innerHTML = '<i class="fas fa-shopping-cart"></i> Add to Cart';
          }
        } catch (err) {
          console.error('Cart error:', err);
          showNotification('Error Occurred', 'Failed to add course to cart. Please try again.', 'error');
          button.disabled = false;
          button.innerHTML = '<i class="fas fa-shopping-cart"></i> Add to Cart';
        }
      });
    });

    // Add to Wishlist functionality
    document.querySelectorAll('.add-to-wishlist-btn').forEach(button => {
      button.addEventListener('click', async (e) => {
        const button = e.currentTarget;
        const courseData = {
          courseId: button.getAttribute('data-course-id'),
          courseType: button.getAttribute('data-course-type'),
          price: button.getAttribute('data-price'),
          courseCode: button.getAttribute('data-course-code')
        };
        const courseTitle = button.getAttribute('data-course-title');

        // Set loading state
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';

        try {
          const response = await fetch('/add-to-wishlist', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(courseData)
          });

          const result = await response.json();
          
          if (result.success) {
            showNotification('Added to Wishlist', `"${courseTitle}" has been saved to your wishlist`, 'success');
            
            // Update button appearance permanently
            button.innerHTML = '<i class="fas fa-heart" style="color: #e74c3c;"></i> Saved';
            button.style.borderColor = '#e74c3c';
            button.style.color = '#e74c3c';
          } else {
            showNotification('Unable to Add', result.message || 'Please try again', 'warning');
            button.disabled = false;
            button.innerHTML = '<i class="fas fa-heart"></i> Wishlist';
          }
        } catch (err) {
          console.error('Wishlist error:', err);
          showNotification('Error Occurred', 'Failed to add course to wishlist. Please try again.', 'error');
          button.disabled = false;
          button.innerHTML = '<i class="fas fa-heart"></i> Wishlist';
        }
      });
    });

    console.log('ðŸŽ“ In-Person Training page loaded successfully');
  </script>

  <%- include('partials/footer') %>
</body>
</html>