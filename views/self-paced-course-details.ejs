<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= course.basic?.title || course.title || 'Course' %> - Self-Paced Online Training</title>
  <meta name="description" content="<%= course.basic.description %>">
  <link rel="stylesheet" href="/css/course-details.css">
  <!-- Social Media Preview Tags -->
  <meta property="og:title" content="<%= course.basic.title %>">
  <meta property="og:description" content="<%= course.basic.description %>">
  <meta property="og:image" content="<%= course.media && course.media.thumbnailUrl ? course.media.thumbnailUrl : '/images/IAAI-Logo.jpg' %>">
  <meta property="og:url" content="http://localhost:3000/self-paced-online-training/courses/<%= course._id %>">
  
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
 
</head>

<body>
  <%- include('partials/header') %>

  <!-- Enhanced Breadcrumb -->
  <nav class="breadcrumb">
    <a href="/"><i class="fas fa-home"></i> Home</a> 
    <i class="fas fa-chevron-right" style="margin: 0 10px; color: #999; font-size: 12px;"></i>
    <a href="/training-programs">Training Programs</a> 
    <i class="fas fa-chevron-right" style="margin: 0 10px; color: #999; font-size: 12px;"></i>
    <a href="/self-paced-online-training">Self-Paced Online Training</a>
    <i class="fas fa-chevron-right" style="margin: 0 10px; color: #999; font-size: 12px;"></i>
    <span><%= course.basic?.title || course.title || 'Course Details' %></span>
  </nav>

  <!-- Enhanced Hero Section -->
  <section class="hero-section">
    <div class="hero-content">
      <div class="hero-header">
        <div class="hero-info">
          <div class="course-code-badge">
            <i class="fas fa-tag"></i> <%= course.basic?.courseCode || course.courseCode || 'N/A' %>
            <% if (course.basic?.category) { %>
              <span class="category-badge"><%= course.basic.category.toUpperCase() %></span>
            <% } %>
          </div>
          <h1 class="hero-title"><%= course.basic?.title || course.title || 'Self-Paced Online Training Course' %></h1>
          <p class="hero-description"><%= course.basic?.description || course.description || 'Master new skills at your own pace with our comprehensive video-based training program.' %></p>
          
          <% if (course.basic?.aboutThisCourse) { %>
          <div class="hero-about">
            <%= course.basic.aboutThisCourse %>
          </div>
          <% } %>
          
          <div class="hero-meta">
            <div class="meta-item">
              <i class="fas fa-user-md"></i>
              <span><%= course.instructor?.name || course.instructor || 'Expert Instructors' %></span>
            </div>
            <div class="meta-item">
              <i class="fas fa-play-circle"></i>
              <span><%= course.videos?.length || course.content?.totalVideos || 0 %> Video Lessons</span>
            </div>
            <div class="meta-item">
              <i class="fas fa-clock"></i>
              <span>
                <%= courseMetrics?.totalDuration ? Math.round(courseMetrics.totalDuration / 60 * 10) / 10 + ' hours' : 
                    course.content?.estimatedMinutes ? Math.round(course.content.estimatedMinutes / 60 * 10) / 10 + ' hours' : 
                    course.totalHours ? course.totalHours + ' hours' : 'Self-paced' %>
              </span>
            </div>
            <div class="meta-item">
              <i class="fas fa-graduation-cap"></i>
              <span><%= course.content?.experienceLevel || course.level || 'All Levels' %></span>
            </div>
            <% if (courseMetrics?.enrollmentCount > 0) { %>
            <div class="meta-item">
              <i class="fas fa-users"></i>
              <span><%= courseMetrics.enrollmentCount %> Students</span>
            </div>
            <% } %>
          </div>
        </div>
        
        <div class="hero-actions">
          <div class="price-display">
            <span class="price-label">Course Price</span>
            <% if ((course.access?.price || course.price || 0) === 0) { %>
              <div class="free-badge">FREE</div>
            <% } else { %>
              <div class="price-amount">
                <span class="price-currency">$</span><%= course.access?.price || course.price || 0 %>
              </div>
              <% if (course.earlyBirdPrice) { %>
                <span class="early-bird-tag">
                  <i class="fas fa-tag"></i> Special Offer: $<%= course.earlyBirdPrice %>
                </span>
              <% } %>
            <% } %>
          </div>
          
          <div class="action-buttons">
            <% if (user) { %>
              <% if (user.mySelfPacedCourses && user.mySelfPacedCourses.some(c => c.courseId.toString() === course._id.toString() && (c.status === 'Paid and Registered' || c.status === 'Registered (promo code)'))) { %>
                <!-- User already registered -->
                <a href="/library" class="btn-primary">
                  <i class="fas fa-book"></i> Go to My Library
                </a>
              <% } else { %>
                <!-- Add to Cart/Wishlist -->
                <button class="btn-primary add-to-cart-btn" 
                        data-course-id="<%= course._id %>" 
                        data-course-type="SelfPacedOnlineTraining"
                        data-price="<%= course.access?.price || course.price || 0 %>"
                        data-course-code="<%= course.basic?.courseCode || course.courseCode || 'N/A' %>"
                        data-course-title="<%= course.basic?.title || course.title || 'Untitled Course' %>"
                        <%= (course.basic?.status !== 'published' && course.status !== 'published') ? 'disabled' : '' %>>
                  <i class="fas fa-shopping-cart"></i> 
                  <%= ((course.access?.price || course.price || 0) === 0) ? 'Enroll for Free' : 'Add to Cart' %>
                </button>
                
                <button class="btn-secondary add-to-wishlist-btn" 
                        data-course-id="<%= course._id %>" 
                        data-course-type="SelfPacedOnlineTraining"
                        data-price="<%= course.access?.price || course.price || 0 %>"
                        data-course-code="<%= course.basic?.courseCode || course.courseCode || 'N/A' %>"
                        data-course-title="<%= course.basic?.title || course.title || 'Untitled Course' %>">
                  <i class="fas fa-heart"></i> Save to Wishlist
                </button>
              <% } %>
            <% } else { %>
              <button class="btn-primary" onclick="showLoginRequired()">
                <i class="fas fa-shopping-cart"></i> 
                <%= ((course.access?.price || course.price || 0) === 0) ? 'Enroll for Free' : 'Add to Cart' %>
              </button>
              <button class="btn-secondary" onclick="showLoginRequired()">
                <i class="fas fa-heart"></i> Save to Wishlist
              </button>
            <% } %>
          </div>
          
          <div class="access-info">
            <div class="access-duration">
              <i class="fas fa-infinity"></i>
              <span>
                <%= course.access?.accessDays ? 
                    (course.access.accessDays === 0 ? 'Lifetime Access' : course.access.accessDays + ' Days Access') : 
                    'Lifetime Access' %>
              </span>
            </div>
            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.7);">
              <i class="fas fa-mobile-alt"></i> Access on any device
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Enhanced Quick Info Bar -->
    <div class="quick-info-bar">
      <div class="info-item">
        <div class="info-icon">
          <i class="fas fa-play-circle"></i>
        </div>
        <div class="info-label">Video Lessons</div>
        <div class="info-value"><%= course.videos?.length || course.content?.totalVideos || 0 %></div>
      </div>
      
      <div class="info-item">
        <div class="info-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div class="info-label">Duration</div>
        <div class="info-value">
          <%= courseMetrics?.totalDuration ? Math.round(courseMetrics.totalDuration / 60 * 10) / 10 + 'h' : 
              course.content?.estimatedMinutes ? Math.round(course.content.estimatedMinutes / 60 * 10) / 10 + 'h' : 
              course.totalHours ? course.totalHours + 'h' : 'Self-paced' %>
        </div>
      </div>
      
      <div class="info-item">
        <div class="info-icon">
          <i class="fas fa-question-circle"></i>
        </div>
        <div class="info-label">Quiz Questions</div>
        <div class="info-value"><%= courseMetrics?.totalQuizQuestions || course.content?.totalQuestions || 0 %></div>
      </div>
      
      <div class="info-item">
        <div class="info-icon">
          <i class="fas fa-certificate"></i>
        </div>
        <div class="info-label">Certificate</div>
        <div class="info-value"><%= course.certification?.enabled ? 'Yes' : 'No' %></div>
      </div>
      
      <div class="info-item">
        <div class="info-icon">
          <i class="fas fa-graduation-cap"></i>
        </div>
        <div class="info-label">Level</div>
        <div class="info-value">
          <%= course.content?.experienceLevel || course.level || 'All Levels' %>
        </div>
      </div>
      
      <div class="info-item">
        <div class="info-icon">
          <i class="fas fa-language"></i>
        </div>
        <div class="info-label">Language</div>
        <div class="info-value">English</div>
      </div>
      
      <div class="info-item">
        <div class="info-icon">
          <i class="fas fa-infinity"></i>
        </div>
        <div class="info-label">Access</div>
        <div class="info-value">
          <%= course.access?.accessDays === 0 || !course.access?.accessDays ? 'Lifetime' : course.access.accessDays + ' Days' %>
        </div>
      </div>
      
      <% if (courseMetrics?.enrollmentCount > 0) { %>
      <div class="info-item">
        <div class="info-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="info-label">Students</div>
        <div class="info-value"><%= courseMetrics.enrollmentCount %></div>
      </div>
      <% } %>
    </div>

    <!-- Course Overview -->
    <% if (course.basic?.description || course.basic?.aboutThisCourse) { %>
    <div class="content-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-info-circle"></i>
        </div>
        <h2 class="section-title">Course Overview</h2>
      </div>
      
      <div class="overview-content">
        <% if (course.basic?.description) { %>
          <p><%= course.basic.description %></p>
        <% } %>
        <% if (course.basic?.aboutThisCourse) { %>
          <p><strong>About This Course:</strong> <%= course.basic.aboutThisCourse %></p>
        <% } %>
      </div>
    </div>
    <% } %>

    <!-- Target Audience -->
    <% if (course.content?.targetAudience && course.content.targetAudience.length > 0) { %>
    <div class="content-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-users"></i>
        </div>
        <h2 class="section-title">Target Audience</h2>
      </div>
      
      <div class="audience-tags">
        <% course.content.targetAudience.forEach(audience => { %>
          <span class="audience-tag"><%= audience %></span>
        <% }) %>
      </div>
    </div>
    <% } %>

    <!-- Learning Objectives -->
    <% if ((course.content?.objectives && course.content.objectives.length > 0) || (course.objectives && course.objectives.length > 0)) { %>
    <div class="content-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-bullseye"></i>
        </div>
        <h2 class="section-title">Learning Objectives</h2>
      </div>
      
      <div class="objectives-grid">
        <% const objectives = course.content?.objectives || course.objectives || []; %>
        <% objectives.forEach((objective, index) => { %>
        <div class="objective-item">
          <div class="objective-number"><%= index + 1 %></div>
          <div class="objective-text"><%= objective %></div>
        </div>
        <% }) %>
      </div>
    </div>
    <% } %>

    <!-- Course Content/Videos -->
    <div class="content-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-play-circle"></i>
        </div>
        <h2 class="section-title">Course Content</h2>
      </div>
      
      <% if (courseMetrics?.totalDuration || courseMetrics?.totalQuizQuestions) { %>
      <div class="course-stats">
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-number"><%= course.videos?.length || 0 %></div>
            <div class="stat-label">Videos</div>
          </div>
          <% if (courseMetrics?.totalDuration) { %>
          <div class="stat-item">
            <div class="stat-number"><%= Math.round(courseMetrics.totalDuration / 60 * 10) / 10 %></div>
            <div class="stat-label">Hours</div>
          </div>
          <% } %>
          <% if (courseMetrics?.totalQuizQuestions > 0) { %>
          <div class="stat-item">
            <div class="stat-number"><%= courseMetrics.totalQuizQuestions %></div>
            <div class="stat-label">Quiz Questions</div>
          </div>
          <% } %>
          <% if (courseMetrics?.hasQuizzes) { %>
          <div class="stat-item">
            <div class="stat-number">âœ“</div>
            <div class="stat-label">Assessments</div>
          </div>
          <% } %>
        </div>
      </div>
      <% } %>
      
      <% if (user && user.mySelfPacedCourses && user.mySelfPacedCourses.some(c => c.courseId.toString() === course._id.toString() && (c.status === 'Paid and Registered' || c.status === 'Registered (promo code)'))) { %>
        <!-- Show full content for enrolled users -->
        <div class="video-curriculum">
          <% if (course.videos && course.videos.length > 0) { %>
            <% course.videos.forEach((video, index) => { %>
            <div class="video-item">
              <div class="video-header">
                <div class="video-number">
                  <i class="fas fa-play-circle"></i>
                  Video <%= index + 1 %>
                </div>
                <% if (video.duration) { %>
                <span class="video-duration">
                  <i class="far fa-clock"></i> <%= video.duration %> min
                </span>
                <% } %>
              </div>
              
              <h3 class="video-title"><%= video.title %></h3>
              <% if (video.description) { %>
              <p class="video-description"><%= video.description %></p>
              <% } %>
              
              <div class="video-actions">
                <% if (video.videoUrl || video.url) { %>
                <a href="<%= video.videoUrl || video.url %>" target="_blank" class="watch-btn">
                  <i class="fas fa-play"></i> Watch Video
                </a>
                <% } %>
                <% if (video.exam && video.exam.length > 0) { %>
                <span class="quiz-indicator">
                  <i class="fas fa-question-circle"></i> 
                  Quiz Available (<%= video.exam.length %> questions)
                </span>
                <% } %>
                <% if (video.transcript) { %>
                <button class="btn-secondary" onclick="toggleTranscript('<%= index %>')" style="padding: 8px 16px; font-size: 12px;">
                  <i class="fas fa-file-text"></i> Transcript
                </button>
                <div id="transcript-<%= index %>" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 14px; line-height: 1.6;">
                  <%= video.transcript %>
                </div>
                <% } %>
              </div>
            </div>
            <% }) %>
          <% } else { %>
            <div class="video-item">
              <div class="video-header">
                <div class="video-number">
                  <i class="fas fa-play-circle"></i>
                  Course Content
                </div>
              </div>
              <h3 class="video-title">Access Your Learning Materials</h3>
              <p class="video-description">Your course content is being prepared. Please check back soon or contact support for assistance.</p>
              <div class="video-actions">
                <a href="/library" class="watch-btn">
                  <i class="fas fa-book"></i> Go to Library
                </a>
              </div>
            </div>
          <% } %>
        </div>
      <% } else { %>
        <!-- Show preview for non-enrolled users -->
        
        <!-- Preview Videos Section with Inline Video Player -->
        <% if (course.videos && course.videos.some(v => v.isPreview)) { %>
        <div class="preview-section" style="margin-bottom: 30px;">
          <h3 style="color: #002147; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-eye" style="color: #b8860b;"></i>
            Free Preview - See What You'll Learn
          </h3>
          
          <div class="preview-videos-grid">
            <% course.videos.filter(v => v.isPreview).forEach((video, index) => { %>
            <div class="preview-video-card">
              <div class="preview-thumbnail" onclick="toggleInlineVideo('<%= video.videoUrl %>', '<%= video.title %>', 'preview-<%= index %>')">
                <div class="preview-play-overlay">
                  <i class="fas fa-play"></i>
                </div>
                <div class="preview-duration">
                  <% if (video.duration) { %>
                    <i class="fas fa-clock"></i> <%= video.duration %> min
                  <% } %>
                </div>
                <div class="preview-badge">FREE PREVIEW</div>
              </div>
              
              <div class="preview-content">
                <h4 class="preview-title"><%= video.title %></h4>
                <p class="preview-description"><%= video.description || 'Get a taste of what this course offers' %></p>
                
                <!-- Watch/Hide Video Button -->
                <button class="preview-watch-btn" onclick="toggleInlineVideo('<%= video.videoUrl %>', '<%= video.title %>', 'preview-<%= index %>')">
                  <i class="fas fa-play"></i>
                  <span class="video-toggle-text" id="toggleText-preview-<%= index %>">Watch Preview Video</span>
                </button>
                
                <!-- Inline Video Container -->
                <div id="inlineVideoContainer-preview-<%= index %>" class="inline-video-container">
                  <button class="video-close-inline" onclick="closeInlineVideo('preview-<%= index %>')">&times;</button>
                  <video id="inlineVideo-preview-<%= index %>" class="inline-video-player" controls preload="metadata">
                    <source src="" type="video/mp4">
                    Your browser does not support the video tag.
                  </video>
                </div>
              </div>
            </div>
            <% }) %>
          </div>
          
          <div class="preview-cta" style="text-align: center; margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px;">
            <p style="color: #666; margin-bottom: 15px;">
              <strong>This is just the beginning!</strong> Unlock <%= course.videos.length - course.videos.filter(v => v.isPreview).length %> more videos with full course access.
            </p>
            <button class="btn-primary" onclick="scrollToEnrollment()" style="display: inline-block; padding: 12px 30px; text-decoration: none;">
              <i class="fas fa-unlock"></i> Unlock Full Course
            </button>
          </div>
        </div>
        <% } %>
       
      <% } %>
    </div>

    <!-- Enhanced Course Features -->
    <div class="content-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-star"></i>
        </div>
        <h2 class="section-title">Course Features</h2>
      </div>
      
      <div class="certification-features">
        <div class="cert-feature">
          <div class="cert-icon">
            <i class="fas fa-infinity"></i>
          </div>
          <h4 class="cert-title">
            <%= course.access?.accessDays === 0 || !course.access?.accessDays ? 'Lifetime Access' : course.access.accessDays + ' Days Access' %>
          </h4>
          <p class="cert-description">Learn at your own pace with unlimited access to all course materials</p>
        </div>
        
        <div class="cert-feature">
          <div class="cert-icon">
            <i class="fas fa-mobile-alt"></i>
          </div>
          <h4 class="cert-title">Mobile Learning</h4>
          <p class="cert-description">Access your courses on any device - desktop, tablet, or mobile</p>
        </div>
        
        <% if (course.certification?.enabled) { %>
        <div class="cert-feature">
          <div class="cert-icon">
            <i class="fas fa-certificate"></i>
          </div>
          <h4 class="cert-title">Certificate of 
            <%= course.certification?.type === 'achievement' ? 'Achievement' : 
                course.certification?.type === 'participation' ? 'Participation' : 
                'Completion' %>
          </h4>
          <p class="cert-description">Earn a professional certificate upon successful course completion</p>
        </div>
        <% } %>
        
        <div class="cert-feature">
          <div class="cert-icon">
            <i class="fas fa-headset"></i>
          </div>
          <h4 class="cert-title">Expert Support</h4>
          <p class="cert-description">
            Get help when you need it - 
            <%= course.support?.responseTime || 'within 48 hours' %> response time
          </p>
        </div>
        
        <% if (courseMetrics?.hasQuizzes) { %>
        <div class="cert-feature">
          <div class="cert-icon">
            <i class="fas fa-question-circle"></i>
          </div>
          <h4 class="cert-title">Interactive Assessments</h4>
          <p class="cert-description">Test your knowledge with <%= courseMetrics.totalQuizQuestions %> quiz questions</p>
        </div>
        <% } %>
        
        <div class="cert-feature">
          <div class="cert-icon">
            <i class="fas fa-clock"></i>
          </div>
          <h4 class="cert-title">Self-Paced Learning</h4>
          <p class="cert-description">Study at your own speed and schedule that works for you</p>
        </div>
      </div>
    </div>

    <!-- Enhanced Instructor Information -->
    <% if (course.instructor?.name || course.instructor) { %>
      <div class="content-section">
        <div class="section-header">
          <div class="section-icon">
            <i class="fas fa-user-md"></i>
          </div>
          <h2 class="section-title">Meet Your Expert Instructor</h2>
        </div>
        
        <div class="instructor-preview-card">
          <%
            // Get instructor data with enhanced fallbacks
            let instructorData = course.instructor?.instructorId || course.instructor?.instructorData;
            let instructorPhoto = instructorData?.profileImage;
            let instructorName = course.instructor?.name || course.instructor || 'Expert Instructor';
            let instructorTitle = course.instructor?.title || instructorData?.title || instructorData?.designation || 'Professional Instructor';
            let instructorBio = instructorData?.bio || 'Experienced professional with extensive expertise in aesthetic medicine and training.';
            let instructorExperience = instructorData?.experience || '10+';
            let instructorSpecializations = instructorData?.specializations || instructorData?.expertise || [];
            let instructorId = instructorData?._id || course.instructor?.instructorId;
          %>
          
          <div class="instructor-preview-layout">
            <!-- Instructor Photo -->
            <div class="instructor-photo-container">
              <% if (instructorPhoto) { %>
                <img src="<%= instructorPhoto %>" 
                     alt="<%= instructorName %>"
                     class="instructor-photo"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
              <% } %>
              
              <!-- Fallback placeholder -->
              <div class="instructor-photo-placeholder" style="<%= instructorPhoto ? 'display: none;' : '' %>">
                <span class="instructor-initials">
                  <%= instructorName.toString().split(' ').map(n => n.charAt(0)).join('').substring(0,2).toUpperCase() %>
                </span>
              </div>
              
              <!-- Verification Badge -->
              <% if (instructorData?.certifications && instructorData.certifications.length > 0) { %>
              <div class="instructor-verification-badge" title="Certified Professional">
                <i class="fas fa-check"></i>
              </div>
              <% } %>
            </div>
            
            <!-- Instructor Info -->
            <div class="instructor-info-content">
              <div class="instructor-header-info">
                <h3 class="instructor-name"><%= instructorName %></h3>
                <p class="instructor-title"><%= instructorTitle %></p>
                
                <!-- Key Credentials -->
                <div class="instructor-credentials-compact">
                  <% if (instructorExperience) { %>
                    <span class="credential-chip">
                      <i class="fas fa-clock"></i> <%= instructorExperience %> Years
                    </span>
                  <% } %>
                  <% if (instructorData?.certifications && instructorData.certifications.length > 0) { %>
                    <span class="credential-chip">
                      <i class="fas fa-certificate"></i> Certified
                    </span>
                  <% } %>
                  <% if (instructorData?.ratings?.overall) { %>
                    <span class="credential-chip">
                      <i class="fas fa-star"></i> <%= instructorData.ratings.overall %> Rating
                    </span>
                  <% } %>
                  <% if (instructorData?.assignedCourses && instructorData.assignedCourses.length > 0) { %>
                    <span class="credential-chip">
                      <i class="fas fa-chalkboard-teacher"></i> <%= instructorData.assignedCourses.length %> Courses
                    </span>
                  <% } %>
                </div>
              </div>
              
              <!-- Brief Bio -->
              <div class="instructor-bio-preview">
                <p><%= instructorBio.substring(0, 200) %><%= instructorBio.length > 200 ? '...' : '' %></p>
              </div>
              
              <!-- Key Specializations -->
              <% if (instructorSpecializations.length > 0) { %>
              <div class="instructor-specializations-preview">
                <h4><i class="fas fa-star"></i> Specializes in:</h4>
                <div class="specialization-tags-compact">
                  <% instructorSpecializations.slice(0, 4).forEach(spec => { %>
                    <span class="specialization-tag"><%= spec %></span>
                  <% }) %>
                  <% if (instructorSpecializations.length > 4) { %>
                    <span class="specialization-tag more">+<%= instructorSpecializations.length - 4 %> more</span>
                  <% } %>
                </div>
              </div>
              <% } %>
              
              <!-- Action Buttons -->
              <div class="instructor-actions-compact">
                <% if (instructorId) { %>
                  <a href="/our-instructors/<%= instructorId %>" class="btn-view-profile">
                    <i class="fas fa-user"></i> View Full Profile
                  </a>
                <% } %>
                <% if (course.support?.email || instructorData?.email) { %>
                  <a href="mailto:<%= course.support?.email || instructorData?.email %>" class="btn-contact-instructor">
                    <i class="fas fa-envelope"></i> Contact
                  </a>
                <% } %>
              </div>
            </div>
            
            <!-- Trust Indicators -->
            <div class="instructor-trust-indicators">
              <div class="trust-badges">
                <% if (instructorData?.status === 'Active') { %>
                <div class="trust-badge">
                  <i class="fas fa-circle text-success"></i>
                  <span>Active Instructor</span>
                </div>
                <% } %>
                <% if (instructorData?.certifications && instructorData.certifications.length > 0) { %>
                <div class="trust-badge">
                  <i class="fas fa-shield-alt text-primary"></i>
                  <span>Certified Professional</span>
                </div>
                <% } %>
                <% if (instructorData?.experience && parseInt(instructorData.experience) >= 5) { %>
                <div class="trust-badge">
                  <i class="fas fa-award text-warning"></i>
                  <span>Experienced</span>
                </div>
                <% } %>
                <% if (instructorData?.ratings?.totalRatings > 10) { %>
                <div class="trust-badge">
                  <i class="fas fa-thumbs-up text-success"></i>
                  <span>Highly Rated</span>
                </div>
                <% } %>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% } %>

    <!-- Enhanced Requirements & System Specs -->
    <div class="content-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-clipboard-list"></i>
        </div>
        <h2 class="section-title">Requirements</h2>
      </div>
      
      <div class="requirements-grid">
        <div class="requirement-card">
          <h4><i class="fas fa-check-circle"></i> Prerequisites</h4>
          <p><%= course.content?.prerequisites || course.prerequisites || 'No prior experience required. Basic understanding of medical or aesthetic concepts is helpful but not mandatory.' %></p>
        </div>
        
        <div class="requirement-card">
          <h4><i class="fas fa-laptop"></i> Technical Requirements</h4>
          <ul class="requirement-list">
            <li>Reliable internet connection</li>
            <li>Modern web browser (Chrome, Firefox, Safari, Edge)</li>
            <li>Device with video playback capability</li>
            <li>Speakers or headphones for audio</li>
          </ul>
        </div>
        
        <div class="requirement-card">
          <h4><i class="fas fa-tools"></i> What You'll Need</h4>
          <ul class="requirement-list">
            <li>Notebook for taking notes</li>
            <li>Quiet learning environment</li>
            <li>Commitment to complete the course</li>
            <li>Willingness to practice learned concepts</li>
          </ul>
        </div>
        
        <div class="requirement-card">
          <h4><i class="fas fa-gift"></i> What's Included</h4>
          <ul class="requirement-list">
            <li>All video lessons and materials</li>
            <li>Downloadable resources</li>
            <% if (course.certification?.enabled) { %>
            <li>Course completion certificate</li>
            <% } %>
            <li>
              <%= course.access?.accessDays === 0 || !course.access?.accessDays ? 'Lifetime' : course.access.accessDays + ' days' %> 
              access to updates
            </li>
            <% if (course.support?.email) { %>
            <li>Direct instructor support</li>
            <% } %>
          </ul>
        </div>
      </div>
    </div>

    <!-- Enhanced Certification Information -->
    <% if (course.certification?.enabled) { %>
    <div class="content-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-certificate"></i>
        </div>
        <h2 class="section-title">Certification</h2>
      </div>
      
      <div class="certification-features">
        <div class="cert-feature">
          <div class="cert-icon">
            <i class="fas fa-award"></i>
          </div>
          <h4 class="cert-title">Certificate Type</h4>
          <p class="cert-description">
            <%= course.certification?.type === 'achievement' ? 'Certificate of Achievement' : 
                course.certification?.type === 'participation' ? 'Certificate of Participation' : 
                'Certificate of Completion' %>
          </p>
        </div>
        
        <div class="cert-feature">
          <div class="cert-icon">
            <i class="fas fa-tasks"></i>
          </div>
          <h4 class="cert-title">Requirements</h4>
          <p class="cert-description">
            <%= course.certification?.requirements?.requireAllVideos ? 'Complete all video lessons' : 'Complete course requirements' %>
            <%= course.certification?.requirements?.minimumScore ? ` and achieve ${course.certification.requirements.minimumScore}% on assessments` : '' %>
            <% if (course.certification?.requirements?.practicalRequired) { %>
              <br>Practical assessment required
            <% } %>
          </p>
        </div>
        
        <div class="cert-feature">
          <div class="cert-icon">
            <i class="fas fa-shield-alt"></i>
          </div>
          <h4 class="cert-title">Verification</h4>
          <p class="cert-description">
            Digital certificate with 
            <%= course.certification?.features?.qrVerification ? 'QR code and ' : '' %>
            unique verification code
            <%= course.certification?.features?.blockchain ? ' on blockchain' : '' %>
          </p>
        </div>
        
        <div class="cert-feature">
          <div class="cert-icon">
            <i class="fas fa-building"></i>
          </div>
          <h4 class="cert-title">Issuing Authority</h4>
          <p class="cert-description">
            <%= course.certification?.issuingAuthority || 'IAAI Training Institute' %>
            <% if (course.certification?.certificationBodies && course.certification.certificationBodies.length > 0) { %>
              <br><small style="color: #666; margin-top: 5px; display: block;">
                <strong>Partners:</strong>
                <% course.certification.certificationBodies.forEach((body, index) => { %>
                  <%= body.name %><%= index < course.certification.certificationBodies.length - 1 ? ', ' : '' %>
                <% }) %>
              </small>
            <% } %>
          </p>
        </div>
        
        <div class="cert-feature">
          <div class="cert-icon">
            <i class="fas fa-calendar-alt"></i>
          </div>
          <h4 class="cert-title">Certificate Validity</h4>
          <p class="cert-description">
            <%= course.certification?.validity?.isLifetime ? 'Lifetime validity' : 
                course.certification?.validity?.years ? `Valid for ${course.certification.validity.years} years` : 
                'Lifetime validity' %>
          </p>
        </div>
        
        <% if (course.certification?.features?.digitalBadge) { %>
        <div class="cert-feature">
          <div class="cert-icon">
            <i class="fas fa-badge"></i>
          </div>
          <h4 class="cert-title">Digital Badge</h4>
          <p class="cert-description">Shareable digital badge for professional networks</p>
        </div>
        <% } %>
      </div>
    </div>
    <% } %>

    <!-- Support Information -->
    <% if (course.support?.email || course.support?.responseTime) { %>
    <div class="content-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-headset"></i>
        </div>
        <h2 class="section-title">Support & Help</h2>
      </div>
      
      <div class="requirements-grid">
        <div class="requirement-card">
          <h4><i class="fas fa-envelope"></i> Contact Support</h4>
          <p>Email: <a href="mailto:<%= course.support?.email || 'support@iaa-i.com' %>"><%= course.support?.email || 'support@iaa-i.com' %></a></p>
          <p>Response Time: <%= course.support?.responseTime || '48 hours' %></p>
        </div>
        
        <div class="requirement-card">
          <h4><i class="fas fa-question-circle"></i> Getting Help</h4>
          <ul class="requirement-list">
            <li>Technical issues with video playback</li>
            <li>Course content questions</li>
            <li>Certificate and completion queries</li>
            <li>Account and access problems</li>
          </ul>
        </div>
      </div>
    </div>
    <% } %>

    <!-- Course Metadata -->
    <% if (courseMetrics?.publishedDate || course.metadata?.tags) { %>
    <div class="content-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-info"></i>
        </div>
        <h2 class="section-title">Course Information</h2>
      </div>
      
      <div style="text-align: center; padding: 20px;">
        <% if (courseMetrics?.publishedDate) { %>
          <p style="color: #666; font-size: 14px;">
            <i class="fas fa-calendar"></i> Published: <%= courseMetrics.publishedDate %>
          </p>
        <% } %>
        <% if (courseMetrics?.enrollmentCount > 0) { %>
          <p style="color: #666; font-size: 14px;">
            <i class="fas fa-users"></i> <%= courseMetrics.enrollmentCount %> students enrolled
          </p>
        <% } %>
        <% if (course.metadata?.tags && course.metadata.tags.length > 0) { %>
          <div style="margin-top: 15px;">
            <strong style="color: #002147;">Tags:</strong>
            <% course.metadata.tags.forEach((tag, index) => { %>
              <span style="display: inline-block; background: #e3f2fd; color: #1976d2; padding: 4px 12px; border-radius: 15px; font-size: 12px; margin: 3px;">
                <%= tag %>
              </span>
            <% }) %>
          </div>
        <% } %>
      </div>
    </div>
    <% } %>

    <!-- FAQ Section -->
    !-- Fixed FAQ Section -->
    <div class="content-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-question-circle"></i>
        </div>
        <h2 class="section-title">Frequently Asked Questions</h2>
      </div>
      
      <div class="faq-accordion">
        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            <h4>How long do I have access to the course?</h4>
            <i class="fas fa-chevron-down faq-icon"></i>
          </div>
          <div class="faq-answer">
            <p>
              You have lifetime access to this course. Once enrolled, you can access all materials anytime, anywhere, and revisit content as often as you'd like.
            </p>
          </div>
        </div>
        
        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            <h4>Can I download the videos for offline viewing?</h4>
            <i class="fas fa-chevron-down faq-icon"></i>
          </div>
          <div class="faq-answer">
            <p>While videos are not downloadable for copyright protection, you can access them anytime with an internet connection. We also provide downloadable resources and materials to support your learning.</p>
          </div>
        </div>
        
        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            <h4>Is there a certificate provided upon completion?</h4>
            <i class="fas fa-chevron-down faq-icon"></i>
          </div>
          <div class="faq-answer">
            <p>Yes! Upon successful completion of all course requirements, you'll receive a digital Certificate of Completion that you can download and share on professional networks.</p>
          </div>
        </div>
        
        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            <h4>What if I need help or have questions during the course?</h4>
            <i class="fas fa-chevron-down faq-icon"></i>
          </div>
          <div class="faq-answer">
            <p>Our support team is available to help with technical issues, and you can reach out to instructors for course-related questions. We typically respond within 24-48 hours.</p>
          </div>
        </div>
        
        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            <h4>Can I get a refund if I'm not satisfied?</h4>
            <i class="fas fa-chevron-down faq-icon"></i>
          </div>
          <div class="faq-answer">
            <p>We offer a 30-day money-back guarantee. If you're not completely satisfied with the course, contact us within 30 days of purchase for a full refund.</p>
          </div>
        </div>
      </div>
    </div>
    

    <!-- Contact Section -->
    <div class="content-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="fas fa-envelope"></i>
        </div>
        <h2 class="section-title">Need More Information?</h2>
      </div>
      
      <div style="text-align: center; padding: 20px;">
        <p style="font-size: 16px; color: #555; margin-bottom: 20px;">
          Have questions about this course? Our learning advisors are here to help you make the right decision for your professional development.
        </p>
        <a href="/contact" class="btn-primary" style="display: inline-block; text-decoration: none;">
          <i class="fas fa-phone"></i> Contact Learning Advisor
        </a>
        <% if (course.support?.email) { %>
          <a href="mailto:<%= course.support.email %>" class="btn-secondary" style="display: inline-block; text-decoration: none; margin-left: 15px;">
            <i class="fas fa-envelope"></i> Email Support
          </a>
        <% } %>
      </div>
    </div>
  </div>

  <!-- Mobile Action Bar -->
  <div class="mobile-action-bar">
    <div class="mobile-action-content">
      <div class="mobile-price">
        <% if ((course.access?.price || course.price || 0) === 0) { %>
          FREE
        <% } else { %>
          $<%= course.access?.price || course.price || 0 %>
        <% } %>
      </div>
      <div class="mobile-buttons">
        <% if (user) { %>
          <% if (user.mySelfPacedCourses && user.mySelfPacedCourses.some(c => c.courseId.toString() === course._id.toString() && (c.status === 'Paid and Registered' || c.status === 'Registered (promo code)'))) { %>
            <a href="/library" class="btn-primary" style="padding: 12px 20px; font-size: 14px; text-decoration: none;">
              <i class="fas fa-book"></i> Go to Library
            </a>
          <% } else { %>
            <button class="btn-primary add-to-cart-btn" 
                    data-course-id="<%= course._id %>" 
                    data-course-type="SelfPacedOnlineTraining"
                    data-price="<%= course.access?.price || course.price || 0 %>"
                    data-course-code="<%= course.basic?.courseCode || course.courseCode || 'N/A' %>"
                    data-course-title="<%= course.basic?.title || course.title || 'Untitled Course' %>"
                    style="padding: 12px 20px; font-size: 14px;">
              <i class="fas fa-shopping-cart"></i> 
              <%= ((course.access?.price || course.price || 0) === 0) ? 'Enroll Free' : 'Add to Cart' %>
            </button>
          <% } %>
        <% } else { %>
          <button class="btn-primary" onclick="showLoginRequired()" style="padding: 12px 20px; font-size: 14px;">
            <i class="fas fa-shopping-cart"></i> 
            <%= ((course.access?.price || course.price || 0) === 0) ? 'Enroll Free' : 'Add to Cart' %>
          </button>
        <% } %>
      </div>
    </div>
  </div>

  <!-- Notification Container -->
  <div id="notificationContainer"></div>

  <script>
    // Show notification function
    function showNotification(title, message, type = 'success') {
      const container = document.getElementById('notificationContainer');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      
      const iconMap = {
        success: 'fa-check-circle',
        error: 'fa-times-circle',
        warning: 'fa-exclamation-triangle'
      };
      
      notification.innerHTML = `
        <div class="notification-icon">
          <i class="fas ${iconMap[type]}"></i>
        </div>
        <div class="notification-content">
          <h4>${title}</h4>
          <p>${message}</p>
        </div>
      `;
      
      container.appendChild(notification);
      
      // Show notification
      setTimeout(() => notification.classList.add('show'), 10);
      
      // Auto remove
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 500);
      }, 5000);
    }

    // Show login required message
    function showLoginRequired() {
      showNotification('Authentication Required', 'Please log in to continue', 'warning');
      setTimeout(() => {
        window.location.href = '/login';
      }, 2000);
    }

    // Set button loading state
    function setButtonLoading(button, loading) {
      if (loading) {
        button.classList.add('btn-loading');
        button.disabled = true;
        const icon = button.querySelector('i');
        if (icon) {
          const originalClass = icon.className;
          icon.setAttribute('data-original-class', originalClass);
          icon.className = 'fas fa-spinner fa-spin';
        }
      } else {
        button.classList.remove('btn-loading');
        button.disabled = false;
        const icon = button.querySelector('i');
        if (icon) {
          const originalClass = icon.getAttribute('data-original-class');
          if (originalClass) {
            icon.className = originalClass;
          }
        }
      }
    }

    // Toggle transcript
    function toggleTranscript(index) {
      const transcript = document.getElementById(`transcript-${index}`);
      if (transcript.style.display === 'none') {
        transcript.style.display = 'block';
      } else {
        transcript.style.display = 'none';
      }
    }

    // INLINE VIDEO FUNCTIONS WITH 30-SECOND LIMIT
    let videoTimers = {}; // Store timers for each video
    
    function toggleInlineVideo(videoUrl, videoTitle, containerId) {
      console.log('toggleInlineVideo called:', videoUrl, videoTitle, containerId);
      
      const container = document.getElementById(`inlineVideoContainer-${containerId}`);
      const video = document.getElementById(`inlineVideo-${containerId}`);
      const source = video.querySelector('source');
      const toggleText = document.getElementById(`toggleText-${containerId}`);
      
      if (!container || !video || !source || !toggleText) {
        console.error('Video elements not found:', containerId);
        return;
      }
      
      if (container.style.display === 'none' || container.style.display === '') {
        // Show video
        source.src = videoUrl;
        video.load();
        container.style.display = 'block';
        toggleText.textContent = 'Hide Preview Video';
        
        // Add time limit overlay
        addTimeOverlay(container, containerId);
        
        // Set up 30-second timer
        setupVideoTimer(video, containerId, videoTitle);
        
        // Scroll to video smoothly
        setTimeout(() => {
          container.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
        }, 100);
        
        console.log('Video opened with 30-second limit:', videoTitle);
      } else {
        // Hide video
        closeInlineVideo(containerId);
      }
    }

    function addTimeOverlay(container, containerId) {
      // Remove existing overlay if any
      const existingOverlay = container.querySelector('.time-remaining-overlay');
      if (existingOverlay) {
        existingOverlay.remove();
      }
      
      // Create time remaining overlay
      const timeOverlay = document.createElement('div');
      timeOverlay.className = 'time-remaining-overlay';
      timeOverlay.id = `timeOverlay-${containerId}`;
      timeOverlay.innerHTML = `
        <div style="position: absolute; top: 15px; left: 15px; background: rgba(220, 53, 69, 0.9); color: white; padding: 8px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; z-index: 15; display: flex; align-items: center; gap: 5px;">
          <i class="fas fa-clock"></i>
          <span id="timeLeft-${containerId}">30s remaining</span>
        </div>
        <div style="position: absolute; top: 15px; right: 60px; background: rgba(40, 167, 69, 0.9); color: white; padding: 6px 10px; border-radius: 15px; font-size: 11px; font-weight: 600; z-index: 15;">
          ðŸŽ¬ FREE PREVIEW
        </div>
      `;
      container.appendChild(timeOverlay);
    }

    function setupVideoTimer(video, containerId, videoTitle) {
      let timeLeft = 30;
      const timeLeftSpan = document.getElementById(`timeLeft-${containerId}`);
      
      // Clear any existing timer
      if (videoTimers[containerId]) {
        clearInterval(videoTimers[containerId]);
      }
      
      // Start timer when video plays
      video.addEventListener('play', function startTimer() {
        if (!videoTimers[containerId]) {
          videoTimers[containerId] = setInterval(() => {
            timeLeft--;
            if (timeLeftSpan) {
              timeLeftSpan.textContent = `${timeLeft}s remaining`;
            }
            
            if (timeLeft <= 0) {
              endPreview(containerId, videoTitle);
            }
          }, 1000);
        }
        // Remove this event listener after first use
        video.removeEventListener('play', startTimer);
      });
      
      // Monitor video time
      video.addEventListener('timeupdate', function() {
        if (video.currentTime >= 30) {
          endPreview(containerId, videoTitle);
        }
      });
      
      // Prevent seeking beyond 30 seconds
      video.addEventListener('seeked', function() {
        if (video.currentTime > 30) {
          video.currentTime = 30;
          endPreview(containerId, videoTitle);
        }
      });
    }

    function endPreview(containerId, videoTitle) {
      console.log('Preview ended for:', videoTitle);
      
      const container = document.getElementById(`inlineVideoContainer-${containerId}`);
      const video = document.getElementById(`inlineVideo-${containerId}`);
      
      if (video) {
        video.pause();
      }
      
      // Clear timer
      if (videoTimers[containerId]) {
        clearInterval(videoTimers[containerId]);
        delete videoTimers[containerId];
      }
      
      // Show preview ended message
      if (container) {
        container.innerHTML = `
          <div style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; padding: 40px 20px; text-align: center; border-radius: 12px;">
            <div style="font-size: 48px; margin-bottom: 20px;">ðŸŽ¬</div>
            <h3 style="margin: 0 0 15px 0; font-size: 24px;">Preview Complete!</h3>
            <p style="margin: 0 0 10px 0; font-size: 16px;">You've seen the first 30 seconds of this lesson.</p>
            <p style="margin: 0 0 25px 0; font-size: 18px; font-weight: bold;">Ready to see the rest?</p>
            <button onclick="scrollToEnrollment(); closeInlineVideo('${containerId}');" 
                    style="background: white; color: #dc3545; border: none; padding: 12px 30px; border-radius: 25px; font-weight: 600; cursor: pointer; font-size: 16px; transition: all 0.3s ease;"
                    onmouseover="this.style.transform='scale(1.05)'"
                    onmouseout="this.style.transform='scale(1)'">
              ðŸ”“ Unlock Full Course Now!
            </button>
          </div>
        `;
      }
    }

    function closeInlineVideo(containerId) {
      console.log('closeInlineVideo called:', containerId);
      
      const container = document.getElementById(`inlineVideoContainer-${containerId}`);
      const video = document.getElementById(`inlineVideo-${containerId}`);
      const toggleText = document.getElementById(`toggleText-${containerId}`);
      
      // Clear any active timer
      if (videoTimers[containerId]) {
        clearInterval(videoTimers[containerId]);
        delete videoTimers[containerId];
      }
      
      if (container && toggleText) {
        container.style.display = 'none';
        toggleText.textContent = 'Watch Preview Video';
        
        // Reset container content for next use
        setTimeout(() => {
          if (container.style.display === 'none') {
            container.innerHTML = `
              <button class="video-close-inline" onclick="closeInlineVideo('${containerId}')">&times;</button>
              <video id="inlineVideo-${containerId}" class="inline-video-player" controls preload="metadata">
                <source src="" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            `;
          }
        }, 500);
        
        console.log('Video closed:', containerId);
      }
    }

    // Scroll to enrollment section
    function scrollToEnrollment() {
      console.log('scrollToEnrollment called');
      
      // Scroll to the top where the purchase options are
      const heroActions = document.querySelector('.hero-actions');
      if (heroActions) {
        heroActions.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'center' 
        });
        
        // Add a subtle highlight effect
        heroActions.style.animation = 'highlight-pulse 2s ease-in-out';
        setTimeout(() => {
          heroActions.style.animation = '';
        }, 2000);
      }
    }

    // Add highlight animation CSS
    const highlightStyle = document.createElement('style');
    highlightStyle.textContent = `
      @keyframes highlight-pulse {
        0% { box-shadow: 0 0 0 0 rgba(184, 134, 11, 0.7); }
        50% { box-shadow: 0 0 0 20px rgba(184, 134, 11, 0.2); }
        100% { box-shadow: 0 0 0 0 rgba(184, 134, 11, 0); }
      }
    `;
    document.head.appendChild(highlightStyle);

    // Add to Cart
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
      button.addEventListener('click', async function(e) {
        e.preventDefault();
        
        const courseId = this.getAttribute('data-course-id');
        const courseType = this.getAttribute('data-course-type');
        const courseTitle = this.getAttribute('data-course-title');
        
        setButtonLoading(this, true);
        
        try {
          const response = await fetch('/add-to-cart', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ courseId, courseType })
          });
          
          const result = await response.json();
          
          if (result.success) {
            showNotification('Added to Cart', `"${courseTitle}" has been added to your cart`, 'success');
          } else {
            showNotification('Error', result.message, 'error');
          }
        } catch (error) {
          console.error('Error:', error);
          showNotification('Error', 'Failed to add to cart', 'error');
        } finally {
          setButtonLoading(this, false);
        }
      });
    });

    // Add to Wishlist
    document.querySelectorAll('.add-to-wishlist-btn').forEach(button => {
      button.addEventListener('click', async function(e) {
        e.preventDefault();
        
        const courseId = this.getAttribute('data-course-id');
        const courseType = this.getAttribute('data-course-type');
        const courseTitle = this.getAttribute('data-course-title');
        
        setButtonLoading(this, true);
        
        try {
          const response = await fetch('/add-to-wishlist', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ courseId, courseType })
          });
          
          const result = await response.json();
          
          if (result.success) {
            showNotification('Added to Wishlist', `"${courseTitle}" has been saved to your wishlist`, 'success');
            
            // Optional: Update button appearance
            this.style.color = '#e74c3c';
            this.querySelector('i').classList.add('fas');
            this.querySelector('i').classList.remove('far');
          } else {
            showNotification('Error', result.message, 'error');
          }
        } catch (error) {
          console.error('Error:', error);
          showNotification('Error', 'Failed to add to wishlist', 'error');
        } finally {
          setButtonLoading(this, false);
        }
      });
    });

    // FAQ Toggle
    function toggleFaq(element) {
      const faqItem = element.parentElement;
      const wasActive = faqItem.classList.contains('active');
      
      // Close all FAQ items
      document.querySelectorAll('.faq-item').forEach(item => {
        item.classList.remove('active');
      });
      
      // Open clicked item if it wasn't active
      if (!wasActive) {
        faqItem.classList.add('active');
      }
    }

    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // Initialize and test
    console.log('ðŸ“š Enhanced self-paced course details page loaded');
    console.log('ðŸ‘¤ User logged in:', <%= user ? 'true' : 'false' %>);
    console.log('ðŸŽ¥ Course ID:', '<%= course._id %>');
    console.log('ðŸ’° Course price:', <%= course.access?.price || course.price || 0 %>);
    console.log('ðŸ“¹ Videos available:', <%= course.videos?.length || 0 %>);
    console.log('ðŸ·ï¸ Course category:', '<%= course.basic?.category || "N/A" %>');
    console.log('ðŸŽ¯ Target audience:', <%= JSON.stringify(course.content?.targetAudience || []) %>);
    console.log('ðŸ“œ Certificate enabled:', <%= course.certification?.enabled || false %>);
    console.log('ðŸ“Š Course metrics:', <%= JSON.stringify(courseMetrics || {}) %>);
</script>
<script>
  // FAQ Toggle Function
  function toggleFaq(element) {
    console.log('FAQ clicked'); // Debug log
    const faqItem = element.parentElement;
    const wasActive = faqItem.classList.contains('active');
    
    console.log('Was active:', wasActive); // Debug log
    
    // Close all FAQ items
    document.querySelectorAll('.faq-item').forEach(item => {
      item.classList.remove('active');
    });
    
    // Open clicked item if it wasn't active
    if (!wasActive) {
      faqItem.classList.add('active');
      console.log('Added active class'); // Debug log
    }
  }
  
  // Test that FAQ is working
  document.addEventListener('DOMContentLoaded', function() {
    console.log('FAQ section loaded');
    const faqItems = document.querySelectorAll('.faq-item');
    console.log('Found', faqItems.length, 'FAQ items');
  });
  </script>
  

  <%- include('partials/footer') %>
</body>
</html>